<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬(Që°©ë²•ë¡ )</title>
<style>
    :root{ --bg:#0f172a; --panel:#111827; --card:#1f2937; --muted:#94a3b8; --text:#e5e7eb; --accent:#6366f1; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(15,23,42,.95),rgba(15,23,42,.6));backdrop-filter:blur(8px);border-bottom:1px solid #1f2937}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{font-size:20px;margin:0 0 6px}
    .sub{color:var(--muted);font-size:13px}
    .hidden{display:none}
    button,select,input,textarea{background:var(--card);color:var(--text);border:1px solid #334155;border-radius:10px;padding:10px 12px;font-size:14px}
    button{font-weight:700;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    button:hover{border-color:var(--accent)}
    input,textarea,select{width:100%}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:16px;margin-top:12px}
    #pool,.col{background:var(--panel);border:1px solid #2b3647;border-radius:12px}
    #pool{padding:12px;min-height:220px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .note{font-size:13px;color:var(--muted)}
    .cols{display:grid;gap:10px}
    .row{display:grid;gap:10px;grid-template-columns:repeat(9,1fr)}
    .col{min-height: 80px;padding:8px;display:flex;flex-direction:column}
    .col-header{display:flex;align-items:center;justify-content:space-between;padding:4px 6px;margin-bottom:6px;border-bottom:1px dashed #334155}
    .tag{font-size:12px;color:var(--muted)}
    .cap{font-size:12px}
    .bucket{display:flex;flex-direction:column;gap:6px}
    .card{font-size: 13px; background:var(--card);border:1px solid #334155;border-radius:12px;padding: 8px 10px;cursor:grab;margin-bottom:6px}
    .card.dragging{opacity:.6}
    .col.over{outline:2px dashed var(--accent);outline-offset:-4px}
    .count-ok{color:var(--ok)}
    .count-warn{color:var(--warn)}
    .count-bad{color:var(--bad)}
    .small{font-size:12px}
    .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
    .chip{background:#0b1222;border:1px solid #2b3647;border-radius:999px;padding:2px 8px;font-size:12px}
    .page{max-width:900px;margin:20px auto;padding:16px;background:var(--panel);border:1px solid #2b3647;border-radius:14px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:13px;color:var(--muted);display:block;margin:10px 0 6px}
    .checkbox-group{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .checkbox-item{display:flex;align-items:center;gap:8px}
    .checkbox-item input[type="checkbox"]{width:16px;height:16px;margin:0;vertical-align:middle}
/* Modal styles */
.modal.hidden { display: none; }
.modal { position: fixed; inset: 0; z-index: 1000; }
.modal__overlay { position:absolute; inset:0; background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
.modal__content { position:relative; max-width: 720px; margin: 8vh auto; background: var(--panel); border:1px solid #2b3647; border-radius: 12px; padding: 16px; }
#poolContainer { border-right: 1px dashed #ccc; }
#poolList { display: block; max-height: 400px; overflow-y: auto; overflow-x: hidden; padding: 8px; width: 100%; box-sizing: border-box; scrollbar-gutter: stable; }
#poolList .card { display: block; width: 100%; margin-bottom: 8px; }
#submitBtn { font-size: 18px; font-weight: bold; padding: 14px 22px; background: var(--accent); color: white; border-radius: 12px; border: none; }
#submitBtn:hover { background: #4338ca; }
</style>
<style>
:root { --card-w: 240px; }
@media (max-width: 1600px) { :root { --card-w: 220px; } }
@media (max-width: 1440px) { :root { --card-w: 200px; } }
@media (max-width: 1280px) { :root { --card-w: 180px; } }
.page { max-width: 98vw !important; }
.grid { grid-template-columns: clamp(200px, 18vw, 280px) 1fr !important; }
.row { grid-template-columns: repeat(9, minmax(var(--card-w), 1fr)) !important; }
#pool .card { width: var(--card-w); }
.col .bucket .card { width: 100%; }
.row { gap: 8px !important; }
.cols { gap: 8px !important; }
.modal.hidden { display: none; }
.modal { position: fixed; inset: 0; z-index: 1000; }
.modal__overlay { position:absolute; inset:0; background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
.modal__content { position:relative; max-width: 720px; margin: 8vh auto; background: var(--panel); border:1px solid #2b3647; border-radius: 12px; padding: 16px; }
</style>
<style>
.help-btn { background: #6366f1; color: #fff; font-weight: bold; border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; transition: background 0.2s, transform 0.1s; }
.help-btn:hover { background: #4f46e5; transform: scale(1.03); }
</style>
<style>
.board { border: 1px solid #2b3647; border-radius: 12px; padding: 12px; background: var(--panel); }
</style>
<style>
.grid { position: relative; align-items: start; }
.grid::after { content: ""; position: absolute; top: 0; bottom: 0; left: clamp(200px, 18vw, 280px); border-left: 2px dashed #334155; pointer-events: none; z-index: 1; }
.board { position: relative; overflow: hidden; background: var(--panel); border: 1px solid #2b3647; border-radius: 12px; padding: 12px; }
</style>
<style>
:root { --card-h: auto; }
.card { height: var(--card-h); overflow:auto; }
</style>
<style>.col-header .tag { color: #ffffff; font-weight: bold; font-size: 15px; }</style>
<style>
#page2 aside #pool #poolList { display: block !important; max-height: 50vh !important; min-height: 240px; overflow-y: auto !important; overflow-x: hidden !important; padding: 8px; box-sizing: border-box; scrollbar-gutter: stable; }
#page2 aside #pool #poolList .card { width: 100% !important; }
</style>
</head>
<body>
<header>
<div class="wrap">
<h1>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬(Që°©ë²•ë¡ )</h1>
<div class="sub">
        1ë‹¨ê³„ì—ì„œ <b>ì‘ë‹µì ì •ë³´</b>ë¥¼ ì…ë ¥í•˜ê³ , 2ë‹¨ê³„ì—ì„œ Qì§„ìˆ ë¬¸ ì¹´ë“œë¥¼ ë¶„í¬ì— ë§ê²Œ ë°°ì¹˜í•œ ë’¤ ì œì¶œí•´ ì£¼ì„¸ìš”.<br/>
        ë³¸ ì„¤ë¬¸ì€ <b>ê°œì¸ ì „ìš© ì´ˆëŒ€ ë§í¬(í† í°)</b>ë¡œ ì ‘ì†í•˜ì…”ì•¼ í•˜ë©°, ì´ë¯¸ ì‚¬ìš©ëœ ë§í¬ëŠ” ë‹¤ì‹œ ì œì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      </div>
</div>
</header>
<main class="wrap">
<section class="page" id="page1">
<h2 style="margin:0 0 12px">1ë‹¨ê³„: ì‘ë‹µì ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ ì£¼ì„¸ìš”.</h2>
<div class="small" id="tokenStatus" style="margin-top:6px;color:var(--muted)">ì´ˆëŒ€ ë§í¬ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤â€¦</div>
<div>
<label for="career">ì„ ìƒë‹˜ì˜ êµì§ ê²½ë ¥ì„ ì„ íƒí•˜ì—¬ ì£¼ì„¸ìš”. *</label>
<select id="career" required>
<option value="">ì„ íƒí•˜ì„¸ìš”</option>
<option value="under5">5ë…„ ë¯¸ë§Œ</option>
<option value="5to10">5ë…„ ì´ìƒ ~ 10ë…„ ë¯¸ë§Œ</option>
<option value="10to15">10ë…„ ì´ìƒ ~ 15ë…„ ë¯¸ë§Œ</option>
<option value="15to20">15ë…„ ì´ìƒ ~ 20ë…„ ë¯¸ë§Œ</option>
<option value="20to25">20ë…„ ì´ìƒ ~ 25ë…„ ë¯¸ë§Œ</option>
<option value="25plus">25ë…„ ì´ìƒ</option>
</select>
</div>
<div>
<label for="schoolLevel">ì„ ìƒë‹˜ê»˜ì„œ í˜„ì¬ ê·¼ë¬´í•˜ê³  ê³„ì‹  í•™êµê¸‰ì„ ì„ íƒí•˜ì—¬ ì£¼ì„¸ìš”. *</label>
<select id="schoolLevel" required>
<option value="">ì„ íƒí•˜ì„¸ìš”</option>
<option value="middle">ì¤‘í•™êµ</option>
<option value="high">ê³ ë“±í•™êµ</option>
</select>
</div>
<div style="margin:14px 0">
<label>ì„ ìƒë‹˜ê»˜ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ì‘ì—…ì— ì°¸ì—¬í•˜ì‹  ì ì´ ìˆë‚˜ìš”? (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥, ì „í˜€ ì—†ìŒ ì„ íƒ ì‹œ ë‹¤ë¥¸ í•­ëª© ì„ íƒ ë¶ˆê°€) *</label>
<div class="checkbox-group" id="experience-options">
<label class="checkbox-item"><input type="checkbox" name="experience" value="curriculumDev"/> êµ­ê°€ìˆ˜ì¤€ ì§€ë¦¬ê³¼ êµìœ¡ê³¼ì • ê°œë°œ ì—°êµ¬</label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="textbookAuth"/> ì§€ë¦¬ê³¼ ê²€Â·ì¸ì • êµê³¼ì„œ ì§‘í•„(ê²€í†  í¬í•¨)</label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="textbookReview"/> ì§€ë¦¬ê³¼ êµê³¼ì„œ ê²€Â·ì¸ì • ì—…ë¬´</label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="materialDev"/> ì§€ë¦¬ê³¼ ê°œì • êµìœ¡ê³¼ì • ê´€ë ¨ êµìˆ˜Â·í•™ìŠµ ë° í‰ê°€ ìë£Œ ê°œë°œ</label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="trainingInstructor"/> ì§€ë¦¬ê³¼ ê°œì • êµìœ¡ê³¼ì • ì„ ë„ êµì› ì—°ìˆ˜ ê°•ì‚¬</label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="curriculumLeader"/> ì§€ë¦¬ê³¼ ê°œì • êµìœ¡ê³¼ì • ì„ ë„ êµì›</label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="plc"/> ì§€ë¦¬ ê´€ë ¨ ì „ë¬¸ì  êµì› í•™ìŠµ ê³µë™ì²´ í™œë™(í•™êµ ì•ˆ, í•™êµ ë°– ëª¨ë‘ í¬í•¨)</label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="other"/> ê¸°íƒ€: <input id="otherExp" type="text" placeholder="ì§ì ‘ ì…ë ¥" style="margin-left:6px;flex:1"/></label>
<label class="checkbox-item"><input type="checkbox" name="experience" value="none"/> ì „í˜€ ì—†ìŒ</label>
</div>
</div>
<div style="margin:14px 0">
<label>ì˜¨ë¼ì¸(ì¤Œ) ë©´ë‹´ ìš”ì²­ ì‹œ ì°¸ì—¬ ê°€ëŠ¥í•˜ì‹­ë‹ˆê¹Œ? *</label>
<select id="zoomConsent" required>
<option value="">ì„ íƒí•˜ì„¸ìš”</option>
<option value="yes">ì°¸ì—¬í•  ì˜í–¥ì´ ìˆìŠµë‹ˆë‹¤.</option>
<option value="no">ì°¸ì—¬í•  ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤.</option>
</select>
</div>
<div style="margin-top:14px">
<label for="email">ì´ë©”ì¼ *</label>
<input id="email" type="email" required/>
</div>
<div>
<label for="phone">í•¸ë“œí° ë²ˆí˜¸ *(ì„¤ë¬¸ ì°¸ì—¬ ê°ì‚¬ ê¸°í”„í‹°ì½˜ ë°œì†¡ìš©)</label>
<input id="phone"/>
</div>
<div class="checkbox-group" style="margin-top:12px">
<label class="checkbox-item"><input id="consent" type="checkbox"/> ì—°êµ¬ ì°¸ì—¬ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
</div>
<div class="toolbar">
  <button id="nextBtn" disabled>ì´ˆëŒ€ ë§í¬ í™•ì¸ ì¤‘â€¦</button>
</div>
</section>
<section class="page hidden" id="page2">
<h2 style="margin:0 0 12px;display:flex;align-items:center;gap:12px;flex-wrap:wrap">2ë‹¨ê³„: Qì§„ìˆ ë¬¸ ì¹´ë“œë¥¼ ë°°ì¹˜í•´ ì£¼ì„¸ìš”.<button class="help-btn" id="helpBtn">ğŸ‘‰ Qì§„ìˆ ë¬¸ ë°°ì¹˜ ìš”ë ¹</button></h2>
<div class="modal hidden" id="helpModal"> <div class="modal__overlay"></div> <div class="modal__content"> <h3 style="margin-top:0">Qì§„ìˆ ë¬¸ ë°°ì¹˜ ìš”ë ¹</h3> <ul style="line-height:1.75"> <li>39ê°œì˜ ì§„ìˆ ì„ ë¨¼ì € ì½ì–´ì£¼ì„¸ìš”.</li> <li>ë™ì˜/ë¹„ë™ì˜ ì •ë„ì— ë”°ë¼ ì¹´ë“œë¥¼ ì˜®ê²¨ì£¼ì„¸ìš”.</li> <li>ê° ë‹¨ê³„ì— ë°°ì¹˜í•  ìˆ˜ ìˆëŠ” ì¹´ë“œ ìˆ˜ëŠ” ì •í•´ì ¸ ìˆìŠµë‹ˆë‹¤.</li> </ul> <div style="margin:10px 0 14px"> <div>-4 â†’ 2ê°œ</div> <div>-3 â†’ 3ê°œ</div> <div>-2 â†’ 4ê°œ</div> <div>-1 â†’ 6ê°œ</div> <div>0 â†’ 9ê°œ</div> <div>1 â†’ 6ê°œ</div> <div>2 â†’ 4ê°œ</div> <div>3 â†’ 3ê°œ</div> <div>4 â†’ 2ê°œ</div> </div> <div style="text-align:right"><button id="helpClose">ë‹«ê¸°</button></div> </div></div>
<div class="grid">
<aside>
<h2 style="margin:8px 0 6px;font-size:16px">ì¹´ë“œ í’€(ë¯¸ë°°ì¹˜)</h2>
<div class="dropzone" data-score="pool" id="pool">
<div class="note">ì—¬ê¸°ì— ë†“ìœ¼ë©´ ì¹´ë“œê°€ â€˜ë¯¸ë°°ì¹˜â€™ ìƒíƒœê°€ ë©ë‹ˆë‹¤.</div>
<div class="bucket" id="poolList"></div>
</div>
<details style="margin-top:10px">
<summary>í˜„ì¬ ë°°ì¹˜ ìš”ì•½</summary>
<div class="small" id="summary" style="margin-top:6px;white-space:pre-wrap"></div>
</details>
<div class="toolbar" style="margin-top:16px"><button id="resetBtn">ë¶„í¬ ì´ˆê¸°í™”</button>
<button id="backBtn">ë’¤ë¡œ (ì‘ë‹µì ì •ë³´)</button>
<button id="submitBtn">ì œì¶œ</button>
</div>
</aside>
<section>
<h2 style="margin:8px 0 6px;font-size:16px">Qì†ŒíŒ… ë¶„í¬ë„</h2><div class="board"><div class="cols">
<div class="row" id="row"></div>
</div></div>
</section>
</div>
<div class="modal hidden" id="thankModal"><div class="modal__overlay"></div><div class="modal__content"><h3>ì„¤ë¬¸ ì œì¶œ ì™„ë£Œ</h3><p>ì„¤ë¬¸ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p><div style="text-align:right; display:flex; gap:8px; justify-content:flex-end;"><button id="thankClose">ë‹«ê¸°</button></div></div></div></section>
</main>
<script>
// === Uniform card height ===
function setUniformCardSize(){
  document.querySelectorAll('.card').forEach(c=>{ c.style.height='auto'; });
  let maxH = 0;
  document.querySelectorAll('.card').forEach(c=>{ maxH = Math.max(maxH, c.offsetHeight); });
  if(maxH < 56) maxH = 56;
  document.documentElement.style.setProperty('--card-h', maxH + 'px');
}
window.addEventListener('resize', ()=> setUniformCardSize());

const PRESET_39 = { scores:[-4,-3,-2,-1,0,1,2,3,4], caps:[2,3,4,6,9,6,4,3,2], labels:[ "-4 (ë§¤ìš° ë¹„ë™ì˜)", "-3 (ë¹„ë™ì˜)", "-2 (ë‹¤ì†Œ ë¹„ë™ì˜)", "-1 (ì•½ê°„ ë¹„ë™ì˜)", "0 (ì¤‘ë¦½/íŒë‹¨ ë³´ë¥˜)", "1 (ì•½ê°„ ë™ì˜)", "2 (ë‹¤ì†Œ ë™ì˜)", "3 (ë™ì˜)", "4 (ë§¤ìš° ë™ì˜)" ] };
const STATEMENTS = [
  {id:1, text:"ì§€ë¦¬ ìˆ˜ì—…ì—ì„œ ì œì‹œí•˜ëŠ” í•™ìŠµ ëª©í‘œëŠ” í˜„ì‹¤ ì„¸ê³„ì˜ ë³µì¡ì„±ì„ ë“œëŸ¬ë‚´ê¸°ë³´ë‹¤ ë‹¨ìˆœí™”ëœ í‹€ê³¼ êµ¬í˜¸ë¡œ ë°˜ë³µëœë‹¤ê³  ëŠë‚€ë‹¤."},
  {id:2, text:"êµì‚¬ëŠ” í•™ìƒì˜ ì‹¤ì œ ê²½í—˜ë³´ë‹¤ êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œ ì† ì„œìˆ ì´ë‚˜ êµê³¼ì„œ ì˜ˆì‹œì— ë§ì¶”ì–´ ìˆ˜ì—…ì„ ê¾¸ë¦´ ìˆ˜ë°–ì— ì—†ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:3, text:"êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì— ì œì‹œëœ ì„±ì·¨ê¸°ì¤€ì€ ì‹¤ì œ ì§€ë¦¬ í˜„ìƒì„ íƒêµ¬í•˜ê²Œ í•˜ê¸°ë³´ë‹¤ ëª¨ë²” ë‹µì•ˆì„ ì°¾ê²Œ ë§Œë“œëŠ” ê²½í–¥ì´ ê°•í•˜ë‹¤."},
  {id:4, text:"í•™ìƒë“¤ì˜ í•™ìŠµ í™œë™ ì°¸ì—¬ëŠ” ììœ¨ì ì¸ íƒêµ¬ë¼ê¸°ë³´ë‹¤ êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œê°€ ìš”êµ¬í•˜ëŠ” í˜•ì‹ì  ìˆ˜í–‰ìœ¼ë¡œ íë¥¸ë‹¤ê³  ë³¸ë‹¤."},
  {id:5, text:"ì§€ë¦¬ êµìœ¡ì—ì„œ ê°•ì¡°í•˜ëŠ” í•™ìŠµ ëª©í‘œ, ê°œë…ë“¤ì€ í˜„ì‹¤ì˜ ë³µì¡í•œ ë¬¸ì œë‚˜ ê°ˆë“±ì„ ë‹´ì§€ ëª»í•˜ê³ , êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œ, êµê³¼ì„œ ì†ì—ì„œ ì •í•´ì§„ ë¬¸êµ¬ì²˜ëŸ¼ í˜•ì‹ì ìœ¼ë¡œ ë‹¤ë¤„ì§„ë‹¤."},
  {id:6, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì€ í•™ìƒê³¼ êµì‚¬ê°€ ë§ë‹¥ëœ¨ë¦¬ëŠ” êµ¬ì²´ì ì´ê³  ë³µì¡í•œ ì§€ë¦¬ì  ì‚¶ì˜ ë§¥ë½ë³´ë‹¤ëŠ”, êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì™€ í‰ê°€ ê´€ë ¨ ì§€ì¹¨ì— ë” ì¶©ì‹¤í•´ì§ˆ ìˆ˜ë°–ì— ì—†ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:7, text:"ì§€ë¦¬ì  ë¬¸ì œ ë° ìŸì ì€ ë³µì¡í•œ í˜„ì‹¤ ë¬¸ì œë¡œ ë‹¤ë¤„ì§€ê¸°ë³´ë‹¤ ë‹¨ìˆœí•œ ì‚¬ë¡€ì™€ ë„ì‹ìœ¼ë¡œë§Œ ì œì‹œë˜ì–´ ê°„ë‹¨í•˜ê²Œ ë‹¤ë¤„ì§„ë‹¤ê³  ë³¸ë‹¤."},
  {id:8, text:"êµ­ê°€ ìˆ˜ì¤€ì˜ êµìœ¡ê³¼ì •ì˜ ì§€ì‹œëŠ” êµì‚¬ì˜ ì°½ì˜ì  í•´ì„ë³´ë‹¤ëŠ” íšì¼ì ì¸ í™œë™ìœ¼ë¡œ ê·€ê²°ë˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤."},
  {id:9, text:"í•™ìƒë“¤ì€ ì‹¤ì œ ì§€ì—­ ì‚¬íšŒë³´ë‹¤ êµê³¼ì„œ ì•ˆì—ì„œ ì •í˜•í™”ëœ ì§€ë¦¬ì  ê°œë… ë° íƒêµ¬ë¥¼ ë°°ìš°ëŠ” ë° ìµìˆ™í•´ì§„ë‹¤ê³  ëŠë‚€ë‹¤."},
  {id:10, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ê°•ì¡°ë˜ëŠ” ìš©ì–´ë‚˜ ê°œë…ì€ ì‹¤ì œ ì§€ë¦¬ í˜„ìƒê³¼ ì—°ê²°ë˜ê¸°ë³´ë‹¤, êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì™€ êµê³¼ì„œ ì•ˆì—ì„œ ì •í•´ì§„ ë¬¸êµ¬ì™€ ì˜ˆì‹œë¡œë§Œ ë°˜ë³µëœë‹¤."},
  {id:11, text:"ì§€ë¦¬ êµìœ¡ì€ ì¢…ì¢… í•™ìƒì˜ ì‹¤ì œ ì´í•´ë³´ë‹¤, êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì´ ì •í•´ ë†“ì€ ì„±ì·¨ê¸°ì¤€ì´ë‚˜ í‰ê°€ ê¸°ì¤€ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒì— ë” ì¹˜ì¤‘í•˜ê²Œ ëœë‹¤."},
  {id:12, text:"êµ­ê°€ìˆ˜ì¤€ ì„±ì·¨ê¸°ì¤€ì´ ì œì‹œí•˜ëŠ” ëª©í‘œë“¤ì€ í•™ìƒë“¤ì˜ ì‚¶ê³¼ ë¬´ê´€í•œ ì±„ â€˜í•´ì•¼ í•˜ëŠ” ê²ƒâ€™ìœ¼ë¡œë§Œ ë°›ì•„ë“¤ì—¬ì§ˆ ìœ„í—˜ì´ í¬ë‹¤ê³  ë³¸ë‹¤."},
  {id:13, text:"í•™ìƒì˜ í•™ìŠµ ì„±ì·¨ ì—¬ë¶€ê°€ ë£¨ë¸Œë¦­(ì±„ì  ê¸°ì¤€í‘œ)ê³¼ ê°™ì€ í‘œì¤€í™”ëœ í‰ê°€ ì§€í‘œë¡œ ì¸¡ì •ë  ë•Œ, í•™ìƒì€ í•™ìŠµ ë³´ë‹¤ í‰ê°€ ì§€í‘œ ë§ì¶”ê¸°ì— ì§‘ì¤‘í•˜ê²Œ ëœë‹¤ê³  ë³¸ë‹¤."},
  {id:14, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì— ì œì‹œëœ ì§€ë¦¬ í•™ìŠµì˜ ëª©í‘œë“¤ì€ ì •í•´ì§„ ë‹µìœ¼ë¡œë§Œ ì½íˆì§€ ì•Šê³ , êµì‚¬ê°€ ì²˜í•œ ì§€ì—­ì  ë§¥ë½ì´ë‚˜ í•™ìƒë“¤ì˜ ì‚¶ì— ë”°ë¼ ë‹¬ë¦¬ í•´ì„ë  ìˆ˜ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:15, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì— ì œì‹œëœ ì„±ì·¨ê¸°ì¤€ ë‹¬ì„±ì„ ìœ„í•´ í•™ìƒì—ê²Œ ì œê³µí•˜ëŠ” í•™ìŠµ ê²½í—˜ì€ êµê³¼ì„œì—ì„œ ì œì‹œëœ í™œë™ ë¿ë§Œ ì•„ë‹ˆë¼, ì£¼ë³€ ì§€ì—­ì˜ ì§€ë¦¬ í˜„ìƒì´ë‚˜ í•™ìƒ ê²½í—˜ìœ¼ë¡œ ììœ ë¡­ê²Œ í™•ì¥í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:16, text:"êµ­ê°€ê°€ ì •í•œ ì§€ë¦¬ êµìœ¡ì˜ ë‚´ìš©ê³¼ ë°©ë²•ê³¼ ê°™ì€ í‹€ì€ ë¶„ëª… ë¬¸ì„œë¡œì„œ ì¡´ì¬í•˜ì§€ë§Œ, êµì‚¬ê°€ í˜„ì¥ì—ì„œ ì¬êµ¬ì„±í•˜ë©´ì„œ ìƒˆë¡œìš´ ìˆ˜ì—… íë¦„ì„ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆëŠ” ì—¬ì§€ê°€ ì¶©ë¶„í•˜ë‹¤ê³  ë³¸ë‹¤."},
  {id:17, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì—ì„œ ì œì‹œí•˜ëŠ” ì§€ë¦¬ ìˆ˜ì—…ì˜ ëª©í‘œ, ë‚´ìš©, ë°©ë²•ë“¤ì€ êµì‚¬ì™€ í•™ìƒì´ í•¨ê»˜ ì‹¤í—˜í•´ë³´ê³  ë³€í˜•í•  ìˆ˜ ìˆëŠ” ì—´ë¦° ì§€ì ìœ¼ë¡œ ì´í•´ëœë‹¤."},
  {id:18, text:"ì •í˜•í™”ëœ ì„±ì·¨ê¸°ì¤€, í•™ìŠµ ëª©í‘œì¡°ì°¨ë„ êµì‚¬ì˜ ì„ íƒì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ìŠµìœ¼ë¡œ êµ¬í˜„ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì¤‘ìš”í•˜ë‹¤ê³  ë³¸ë‹¤."},
  {id:19, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì— ì—†ëŠ” ì§€ë¦¬ì  ì£¼ì œë¥¼ ë‹¤ë£¨ë”ë¼ë„ í•™ìƒ ì‚¶ê³¼ ì—°ê²°ëœë‹¤ë©´ ì¶©ë¶„íˆ êµìœ¡ê³¼ì •ì˜ ì˜ë¯¸ ì•ˆì— í¬í•¨ëœë‹¤ê³  ì—¬ê¸´ë‹¤."},
  {id:20, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì˜ ì§€ì¹¨ì€ ì§€ë¦¬ êµì‚¬ì—ê²Œ í†µì œì˜ ì¥ì¹˜ì´ë©´ì„œë„ ë™ì‹œì— ì°½ì˜ì  í•´ì„ì˜ ê°€ëŠ¥ì„±ì„ ë‚¨ê²¨ë‘”ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:21, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì€ êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì— ì íŒ ê¸°ì¤€ì„ ê·¸ëŒ€ë¡œ ë”°ë¥´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë¥¼ í•™ìƒë“¤ì˜ ê²½í—˜ ì„¸ê³„ì™€ ì—°ê²°í•˜ëŠ” ê²ƒì´ë¼ê³  ë³¸ë‹¤."},
  {id:22, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì—ì„œ ì œì‹œí•˜ëŠ” êµìˆ˜â€¤í•™ìŠµ ë° í‰ê°€ ë°©í–¥ì„ ì™„ì „íˆ ë”°ë¥´ì§€ ì•Šë”ë¼ë„, êµì‚¬ê°€ í•™ìƒê³¼ ì§€ì—­ ìƒí™© ë§ê²Œ ì§€ë¦¬ ìˆ˜ì—…ì„ ììœ¨ì ìœ¼ë¡œ ì¬êµ¬ì„±í•˜ì—¬ ì§„í–‰í•˜ëŠ” ê²ƒì€ ì •ë‹¹í•˜ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:23, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì€ ì§€ë¦¬ êµì‚¬ì—ê²Œ ë‹¨ì¼í•œ ê¸¸ì´ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ê°ˆë˜ì˜ ê¸¸ì„ ì—´ì–´ì£¼ëŠ” ì¶œë°œì ìœ¼ë¡œ ì½íŒë‹¤."},
  {id:24, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ê³¼ ì‹¤ì²œì€ ì–¸ì œë‚˜ ë¬¸ì„œì— ì íŒ ì§€ì‹œë³´ë‹¤ ë” í’ë¶€í•˜ê³  ë‹¤ì–‘í•  ìˆ˜ ìˆë‹¤."},
  {id:25, text:"ì§€ë¦¬ ìˆ˜ì—…ì—ì„œëŠ” êµ­ê°€ìˆ˜ì¤€ì˜ ì„±ì·¨ê¸°ì¤€ë³´ë‹¤ í•™ìƒê³¼ ì§€ì—­ì˜ íŠ¹ìˆ˜ì„±ì„ ë¨¼ì € ê³ ë ¤í•´ì•¼ í•œë‹¤ê³  ë³¸ë‹¤."},
  {id:26, text:"ì§€ë¦¬ ìˆ˜ì—…ì˜ ì˜ë¯¸ëŠ” êµì‚¬, í•™ìƒ, êµì‹¤ í™˜ê²½, ì§€ì—­ ìë£Œê°€ ì–´ë–»ê²Œ ì–´ìš¸ë¦¬ëŠëƒì— ë”°ë¼ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì— êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë° êµê³¼ì—ì„œ ì œì‹œí•œ í•™ìŠµ ìˆœì„œë„ í˜„ì¥ì— ë§ê²Œ ì¬êµ¬ì„±ë  ìˆ˜ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:27, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì—ì„œ ì œì‹œëœ ì§€ë¦¬ êµìœ¡ì˜ ëª©í‘œë“¤ì€ ë‹¨ìˆœí•œ ì§€ì‹ ì „ë‹¬ì„ ë„˜ì–´, êµì‚¬ ìì‹ ì´ ì–´ë–¤ ì¡´ì¬ì¸ì§€ ì„±ì°°í•˜ê²Œ ë§Œë“œëŠ” ê³„ê¸°ë¡œ ì½íŒë‹¤."},
  {id:28, text:"í•™ìƒë“¤ì´ ë°°ìš°ëŠ” ì§€ë¦¬ì  ì§€ì‹, ê¸°ëŠ¥, ê°€ì¹˜â€¤íƒœë„ ë“±ì€ ê²°êµ­ ìê¸° ì‚¶ì„ ëŒì•„ë³´ê²Œ í•˜ëŠ” ë¬¼ìŒì´ ë˜ì–´ì•¼ í•œë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:29, text:"ì§€ë¦¬ ìˆ˜ì—…ì—ì„œ ì œì‹œë˜ëŠ” í•™ìŠµ ëª©í‘œë“¤ì€ ê°ê´€ì  ì§€ë¦¬ì  ì‚¬ì‹¤ì˜ ë‚˜ì—´ì´ ì•„ë‹ˆë¼, í•™ìƒì´ ì–´ë–»ê²Œ ì„¸ê³„ ì†ì— ì‚´ì•„ê°€ê³  ìˆëŠ”ì§€ë¥¼ ë¬»ëŠ” ê³„ê¸°ë¼ê³  ë³¸ë‹¤."},
  {id:30, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì€ í•™ìƒì˜ ìƒí™œì„¸ê³„ì™€ ì—°ê²°ë  ë•Œ ë¹„ë¡œì†Œ êµìœ¡ì  ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤ê³  ëŠë‚€ë‹¤."},
  {id:31, text:"ì§€ë¦¬ êµìœ¡ì€ êµì‚¬ì™€ í•™ìƒì´ í•¨ê»˜ ì„¸ê³„ì™€ ìê¸° ìì‹ ì„ ì„±ì°°í•˜ëŠ” ì¥ìœ¼ë¡œ ê¸°ëŠ¥í•´ì•¼ í•œë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:32, text:"êµ­ê°€ê°€ ì œì‹œí•˜ëŠ” ì§€ë¦¬ êµìœ¡ì˜ ëª©í‘œëŠ” í•™ìƒì´ ìê¸° ê°€ëŠ¥ì„±ì„ ë°œê²¬í•˜ëŠ” ê¸°íšŒë¡œ ì „í™˜ë  ìˆ˜ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:33, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œê°€ ë§í•˜ëŠ” ì„±ì·¨ê¸°ì¤€ë“¤ì€ ë‹¨ìˆœíˆ ì™¸ì›Œì•¼ í•  ì§€ì‹ì´ ì•„ë‹ˆë¼, ì‚¶ì˜ ë¬¸ì œì™€ ì—°ê²°ë  ë•Œ ì˜ë¯¸ê°€ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:34, text:"í•™ìƒì€ ì§€ë¦¬ë¥¼ í†µí•´ ìê¸° ì‚¶ê³¼ ì„¸ê³„ë¥¼ ì§ˆë¬¸í•˜ê³  ëŒ€ë‹µí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ê³  ì—¬ê¸´ë‹¤."},
  {id:35, text:"ì§€ë¦¬ êµìœ¡ì—ì„œ ì¤‘ìš”í•œ ê²ƒì€ ì‚¬ì‹¤ì˜ ì¶•ì ë³´ë‹¤ ìì‹ ì˜ ê²½í—˜ ì†ì—ì„œ ì˜ë¯¸ë¥¼ ë°œê²¬í•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤."},
  {id:36, text:"êµì‚¬ëŠ” í•™ìƒì´ ìˆ˜ë™ì ìœ¼ë¡œ ë°°ìš°ëŠ” ì¡´ì¬ê°€ ì•„ë‹ˆë¼, ìê¸° ì‚¶ì„ ì£¼ì²´ì ìœ¼ë¡œ ì‚´ì•„ê°€ëŠ” ì¡´ì¬ê°€ ë˜ë„ë¡ ë•ëŠ”ë‹¤ê³  ë³¸ë‹¤."},
  {id:37, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œë¥¼ ì½ëŠ” ì¼ì€ êµì‚¬ì—ê²Œë„ ìê¸° ì¡´ì¬ë¥¼ ìƒˆë¡­ê²Œ ì´í•´í•˜ëŠ” ê¸°íšŒê°€ ëœë‹¤."},
  {id:38, text:"ì§€ë¦¬ ìˆ˜ì—…ì€ êµì‚¬ì™€ í•™ìƒì´ í•¨ê»˜ ì„¸ê³„ ì†ì—ì„œ ì‚´ì•„ê°€ê³  ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ë“œëŸ¬ë‚´ëŠ” ì¥ì´ë¼ê³  ìƒê°í•œë‹¤."},
  {id:39, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë° êµê³¼ì„œ ì§€ì‹œëŒ€ë¡œë§Œ ì§„í–‰í•˜ëŠ” ìˆ˜ì—…ì€ êµì‚¬ì™€ í•™ìƒì˜ ë°œì „ì„ ë§‰ê¸° ë•Œë¬¸ì—, í° íë¦„ë§Œ ì°¸ê³ í•´ êµì‚¬ê°€ ìƒˆë¡­ê²Œ ìˆ˜ì—…ì„ êµ¬ì„±í•  ë•Œ êµì‚¬ì™€ í•™ìƒ ëª¨ë‘ ì„±ì¥í•  ìˆ˜ ìˆë‹¤."}
];
let cards = JSON.parse(JSON.stringify(STATEMENTS));
let columns = [];
let selectedCardId = null;
let SUBMITTING = false;

const poolList = document.getElementById('poolList');
const rowEl = document.getElementById('row');
const summaryEl = document.getElementById('summary');

function showPage(n){
  document.getElementById('page1').classList.toggle('hidden', n!==1);
  document.getElementById('page2').classList.toggle('hidden', n!==2);
}

// ===== 1ë‹¨ê³„ ê²€ì¦ =====
function validateRespondent(){
  const career = document.getElementById('career').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const schoolLevel = document.getElementById('schoolLevel').value.trim();
  if(!schoolLevel){ alert('í˜„ì¬ ê·¼ë¬´í•˜ê³  ê³„ì‹  í•™êµê¸‰ì„ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  const email = document.getElementById('email').value.trim();
  const zoomConsent = document.getElementById('zoomConsent').value.trim();
  const consent = document.getElementById('consent').checked;
  const checked = [...document.querySelectorAll('#experience-options input[name="experience"]:checked')];
  const otherChecked = checked.some(i=> i.value==='other');
  const otherText = (document.getElementById('otherExp')||{}).value ? document.getElementById('otherExp').value.trim() : '';

  if(!career){ alert('êµì§ ê²½ë ¥ì„ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  if(checked.length===0){ alert('ì‘ì—… ì°¸ì—¬ ê²½í—˜ì„ ìµœì†Œ 1ê°œ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  if(checked.some(i=> i.value==='none') && checked.length>1){ alert('"ì „í˜€ ì—†ìŒ"ì„ ì„ íƒí•œ ê²½ìš° ë‹¤ë¥¸ í•­ëª©ì€ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return false; }
  if(otherChecked && !otherText){ alert('ê¸°íƒ€ë¥¼ ì„ íƒí•˜ì…¨ë‹¤ë©´ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return false; }
  if(!zoomConsent){ alert('ì˜¨ë¼ì¸ ë©´ë‹´ ì°¸ì—¬ ì˜í–¥ì„ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  if(!email){ alert('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.'); return false; }
  if(!phone){ alert('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return false; }
  if(!consent){ alert('ì—°êµ¬ ì°¸ì—¬ì— ë™ì˜í•´ ì£¼ì„¸ìš”.'); return false; }
  return true;
}

// ===== ì²´í¬ë°•ìŠ¤: 'ì „í˜€ ì—†ìŒ' ë‹¨ë… ì„ íƒ ê·œì¹™ =====
document.addEventListener('DOMContentLoaded', ()=>{
  const expOptions = document.querySelectorAll('#experience-options input[type="checkbox"]');
  const noneOption = document.querySelector('#experience-options input[value="none"]');
  expOptions.forEach(opt=>{
    opt.addEventListener('change', ()=>{
      if(noneOption.checked){
        expOptions.forEach(o=>{ if(o!==noneOption) o.checked=false; });
      } else {
        if(opt!==noneOption) noneOption.checked=false;
      }
    });
  });
});

// ===== í˜ì´ì§€ ì „í™˜ =====
async function onNext(){
  // URL í† í° í™•ì¸
  const tok = window.__QSORT_TOKEN__ || '';
  const ok = await checkTokenWithServer(tok);
  if(!ok) return;
  // ì‘ë‹µì ì •ë³´ í™•ì¸
  if(!validateRespondent()) return;
  showPage(2);
}
document.getElementById('nextBtn').addEventListener('click', onNext);
document.getElementById('backBtn')?.addEventListener('click', ()=> showPage(1));

// ===== Q-sort ë³´ë“œ ë Œë”ë§ =====
function makeEl(tag, cls){ const e=document.createElement(tag); if(cls) e.className=cls; return e; }
function renderColumns(){
  rowEl.innerHTML=''; columns=[];
  const {scores,caps,labels} = PRESET_39;
  scores.forEach((score,i)=>{
    const col = makeEl('div','col dropzone');
    col.dataset.score = score;
    const head = makeEl('div','col-header');
    const tag = makeEl('div','tag'); tag.textContent = labels[i];
    const cap = makeEl('div','cap'); cap.innerHTML = `í• ë‹¹ <span class="capnum">${caps[i]}</span> / <span class="usednum">0</span>`;
    head.append(tag,cap);
    const bucket = makeEl('div','bucket');
    col.append(head,bucket); rowEl.append(col);
    columns.push({score, cap:caps[i], el:col});
  });
  attachDnD(); refreshAll();
}
function getBucket(colEl){ return colEl.querySelector('.bucket'); }
function capStatus(col){
  const bucket = getBucket(col.el); if(!bucket) return;
  const used = bucket.children.length;
  const usednum = col.el.querySelector('.usednum'); if(!usednum) return;
  usednum.textContent = used;
  const cls = used===col.cap? 'count-ok' : (used<col.cap? 'count-warn':'count-bad');
  usednum.className = 'usednum ' + cls; col.el.classList.toggle('over', used>col.cap);
}
function refreshAll(){ columns.forEach(capStatus); updateSummary(); }

function createCardEl(card){
  const el = makeEl('div','card'); el.draggable=true; el.dataset.id=card.id;
  el.innerHTML = '<div class="small" style="opacity:.7">#'+card.id+'</div>'+card.text;
  el.addEventListener('dragstart', e=>{ el.classList.add('dragging'); e.dataTransfer.setData('text/plain', String(card.id)); });
  el.addEventListener('dragend', ()=> el.classList.remove('dragging'));
  el.addEventListener('click', ()=>{
    if(selectedCardId===card.id){ selectedCardId=null; el.style.outline=''; return; }
    document.querySelectorAll('.card').forEach(c=> c.style.outline='');
    selectedCardId=card.id; el.style.outline=`2px solid ${getComputedStyle(document.documentElement).getPropertyValue('--accent')}`;
  });
  return el;
}
function ensureCards(){ poolList.innerHTML=''; cards.forEach(c=> poolList.appendChild(createCardEl(c))); refreshAll(); setUniformCardSize(); }

function attachDnD(){
  const zones = document.querySelectorAll('.dropzone');
  zones.forEach(z=>{
    z.addEventListener('dragover', e=>{ e.preventDefault(); z.classList.add('over'); });
    z.addEventListener('dragleave', ()=> z.classList.remove('over'));
    z.addEventListener('drop', e=>{ e.preventDefault(); z.classList.remove('over'); const id=+e.dataTransfer.getData('text/plain'); moveCardTo(id,z); });
    z.addEventListener('click', ()=>{ if(selectedCardId!=null){ moveCardTo(selectedCardId,z); selectedCardId=null; document.querySelectorAll('.card').forEach(c=> c.style.outline=''); }});
  });
}
function moveCardTo(id, zone){
  const cardEl = document.querySelector(`.card[data-id="${id}"]`); if(!cardEl) return;
  const targetBucket = zone.id==='pool' ? poolList : getBucket(zone);
  if(zone.id!=='pool'){
    const col = columns.find(c=> String(c.score)===zone.dataset.score);
    if(getBucket(zone).children.length>=col.cap){ zone.classList.add('over'); setTimeout(()=> zone.classList.remove('over'), 300); return; }
  }
  targetBucket.appendChild(cardEl); refreshAll(); setUniformCardSize();
}

function updateSummary(){
  if(!summaryEl) return;
  const lines=[]; columns.forEach(c=>{ const b=getBucket(c.el); const ids=b?[...b.children].map(e=> e.dataset.id):[]; lines.push(`${c.score}: ${ids.join(', ')||'-'}`); });
  const poolIds=[...poolList.children].map(e=> e.dataset.id); lines.push(`ë¯¸ë°°ì¹˜: ${poolIds.join(', ')||'-'}`); summaryEl.textContent=lines.join('\n');
}

// ë¶„í¬ ì´ˆê¸°í™”
document.getElementById('resetBtn')?.addEventListener('click', ()=>{
  document.querySelectorAll('.col .bucket').forEach(b=>{
    [...b.children].forEach(card=> poolList.appendChild(card));
  });
  refreshAll();
});

// ========== Apps Script í†µì‹  ë° í† í° ì ê¸ˆ ë¡œì§ ==========
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxr3fORzxqC94mS_KAWSeL_NFwzIctrus9ntJSfHjofSUMNqTmH7Pb7fZfqeLoQMRNwdA/exec";

function markTokenUsedLocally(t){ try{ localStorage.setItem(`qsort_token_used_${t}`, '1'); }catch(_){} }
function isTokenUsedLocally(t){ try{ return localStorage.getItem(`qsort_token_used_${t}`)==='1'; }catch(_){ return false; } }

function setTokenUI(status, msg){
  const st = document.getElementById('tokenStatus');
  const btn = document.getElementById('nextBtn');
  if(st){ st.textContent = msg || ''; st.style.color = status==='ok' ? 'var(--ok)' : status==='warn' ? 'var(--warn)' : 'var(--muted)'; }
  if(btn){
    if(status==='ok'){ btn.disabled = false; btn.textContent = 'ë‹¤ìŒ (ì •ë ¬ ë‹¨ê³„ë¡œ ì´ë™)'; }
    else if(status==='checking'){ btn.disabled = true; btn.textContent = 'ì´ˆëŒ€ ë§í¬ í™•ì¸ ì¤‘â€¦'; }
    else { btn.disabled = true; btn.textContent = 'ì´ˆëŒ€ ë§í¬ í™•ì¸ í•„ìš”'; }
  }
}
function getTokenFromURL(){
  try{
    const url = new URL(window.location.href);
    const sp = url.searchParams;
    let t = (sp.get('t') || sp.get('token') || '').trim();
    if(!t && url.hash){ const m = url.hash.match(/(?:token|t)=([^&]+)/); if(m) t = decodeURIComponent(m[1]); }
    return t;
  }catch(_){ return ''; }
}
async function checkTokenWithServer(token){
  if(!token){ setTokenUI('warn','ì´ˆëŒ€ ë§í¬ì— í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ì´ˆëŒ€ ë©”ì¼ì˜ ë§í¬ë¡œ ì ‘ì†í•´ ì£¼ì„¸ìš”.'); return false; }
  if(isTokenUsedLocally(token)){ setTokenUI('warn','ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì´ë¯¸ ì‚¬ìš©ëœ ë§í¬ì…ë‹ˆë‹¤.'); return false; }
  try{
    setTokenUI('checking','ì´ˆëŒ€ ë§í¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤â€¦');
    const qs = new URLSearchParams({ action:'checkToken', token });
    const res = await fetch(`${APPS_SCRIPT_URL}?${qs}`, { method:'GET', mode:'cors' });
    if(!res.ok){ throw new Error('HTTP '+res.status); }
    const data = await res.json();
    if(data && data.ok && data.status==='valid'){ setTokenUI('ok','ì´ˆëŒ€ ë§í¬ í™•ì¸ ì™„ë£Œ'); return true; }
    if(data && data.status==='used'){ setTokenUI('warn','ì´ë¯¸ ì‚¬ìš©ëœ ë§í¬ì…ë‹ˆë‹¤.'); return false; }
    setTokenUI('warn', (data && data.message) || 'ìœ íš¨í•˜ì§€ ì•Šì€ ë§í¬ì…ë‹ˆë‹¤.'); return false;
  }catch(e){
    setTokenUI('warn','ë§í¬ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    return false;
  }
}

// URL í† í° ìë™ í™•ì¸
(function(){
  window.__QSORT_TOKEN__ = getTokenFromURL();
  const tok = window.__QSORT_TOKEN__ || '';
  checkTokenWithServer(tok);
})();

// ì œì¶œ
const submitBtn = document.getElementById('submitBtn');
submitBtn.addEventListener('click', async ()=>{
  if (SUBMITTING) return;
  const unmet = columns.filter(c=> getBucket(c.el).children.length !== c.cap);
  if(unmet.length>0){
    alert('ë¶„í¬ ìš©ëŸ‰ì„ ì •í™•íˆ ë§ì¶° ì£¼ì„¸ìš”.');
    return;
  }
  const token = window.__QSORT_TOKEN__ || '';
  if(!token){ alert('ì´ˆëŒ€ ë§í¬ì— í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ì²˜ìŒ í˜ì´ì§€ë¡œ ëŒì•„ê°€ ì£¼ì„¸ìš”.'); showPage(1); return; }

  SUBMITTING = true;
  submitBtn.setAttribute('disabled','true');
  submitBtn.textContent = 'ì œì¶œ ì¤‘...';

  const payload = {
    action: 'submit',
    token,
    career: (document.getElementById('career')?.value || '').trim(),
    schoolLevel: (document.getElementById('schoolLevel')?.value || '').trim(),
    experience: Array.from(document.querySelectorAll('input[name="experience"]:checked')).map(el => el.value),
    experienceOther: (document.getElementById('otherExp')?.value || '').trim(),
    zoomConsent: (document.getElementById('zoomConsent')?.value || '').trim(),
    email: (document.getElementById('email')?.value || '').trim(),
    phone: (document.getElementById('phone')?.value || '').trim(),
    qsort: (function(){
      const arr=[];
      document.querySelectorAll('.col.dropzone').forEach(col=>{
        const score = Number(col.dataset.score);
        col.querySelectorAll('.bucket .card').forEach(card=>{
          arr.push({ id: Number(card.dataset.id), score });
        });
      });
      return arr;
    })()
  };

  try{
    const res = await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      mode: 'cors',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify(payload)
    });
    if(!res.ok){ throw new Error('HTTP '+res.status); }
    const data = await res.json();
    if(data && data.ok){
      const thankModal = document.getElementById('thankModal');
      if (thankModal) thankModal.classList.remove('hidden');
      markTokenUsedLocally(token);
      return true;
    } else {
      alert((data && data.message) || 'ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì„œë²„ ì‘ë‹µ)');
      submitBtn.removeAttribute('disabled');
      submitBtn.textContent = 'ì œì¶œ';
      SUBMITTING = false;
      return false;
    }
  }catch(err){
    alert('ë„¤íŠ¸ì›Œí¬/ì„œë²„ ì˜¤ë¥˜ë¡œ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    submitBtn.removeAttribute('disabled');
    submitBtn.textContent = 'ì œì¶œ';
    SUBMITTING = false;
    return false;
  }
});

// ë„ì›€ë§ íŒì—…
const helpBtn = document.getElementById('helpBtn');
const helpModal = document.getElementById('helpModal');
const helpClose = document.getElementById('helpClose');
if (helpBtn && helpModal && helpClose){
  helpBtn.addEventListener('click', ()=> helpModal.classList.remove('hidden'));
  helpClose.addEventListener('click', ()=> helpModal.classList.add('hidden'));
  helpModal.querySelector('.modal__overlay').addEventListener('click', ()=> helpModal.classList.add('hidden'));
}

// ì´ˆê¸° ë Œë”ë§
renderColumns(); ensureCards(); setUniformCardSize(); showPage(1);

// Enter í‚¤ë¡œ ì¬ì œì¶œ ë°©ì§€
document.addEventListener('keydown', (e)=>{
  const onPage2 = !document.getElementById('page2').classList.contains('hidden');
  if (onPage2 && e.key === 'Enter') { e.preventDefault(); }
});
</script>
<script>
// í’€(ì¹´ë“œ ëª©ë¡) í•­ìƒ ì˜¤ë¦„ì°¨ìˆœ ìœ ì§€
(function(){
  function getCardId(el){
    if (!el) return Number.MAX_SAFE_INTEGER;
    if (el.dataset && el.dataset.id !== undefined && el.dataset.id !== "") {
      var n = Number(el.dataset.id);
      if (!Number.isNaN(n)) return n;
    }
    var m = (el.textContent || "").match(/#\s*(\d+)/);
    return m ? Number(m[1]) : Number.MAX_SAFE_INTEGER;
  }
  var sorting = false;
  function sortPoolAscending(){
    if (sorting) return;
    var pool = document.getElementById('poolList');
    if (!pool) return;
    sorting = true;
    var nodes = Array.prototype.slice.call(pool.children);
    nodes.sort(function(a,b){ return getCardId(a) - getCardId(b); });
    nodes.forEach(function(n){ pool.appendChild(n); });
    sorting = false;
  }

  document.addEventListener('DOMContentLoaded', function(){
    var pool = document.getElementById('poolList');
    if (!pool) return;
    sortPoolAscending();
    var timer = null;
    var obs = new MutationObserver(function(muts){
      if (sorting) return;
      if (timer) clearTimeout(timer);
      timer = setTimeout(sortPoolAscending, 0);
    });
    obs.observe(pool, { childList: true });

    if (typeof window.resetDistribution === 'function'){
      var _reset = window.resetDistribution;
      window.resetDistribution = function(){
        var r = _reset.apply(this, arguments);
        setTimeout(sortPoolAscending, 0);
        return r;
      };
    }
    if (typeof window.showPage === 'function'){
      var _show = window.showPage;
      window.showPage = function(){
        var r = _show.apply(this, arguments);
        setTimeout(sortPoolAscending, 0);
        return r;
      };
    }
  });
})();
</script>
<script>
(function(){
  const m = document.getElementById('thankModal');
  if (!m) return;
  const btn = document.getElementById('thankClose');
  const ov = m.querySelector('.modal__overlay');
  function closeModal(){ m.classList.add('hidden'); }
  if (btn) btn.addEventListener('click', closeModal);
  if (ov) ov.addEventListener('click', closeModal);
})();
</script>
<section class="page hidden" id="page3">
<h2>ì œì¶œ ì™„ë£Œ</h2>
<p>ì„¤ë¬¸ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ê²°ê³¼ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
</section>

<script>
// ì œì¶œ ì™„ë£Œ ëª¨ë“œ ì „í™˜(ë²„íŠ¼ â†’ ì™„ë£Œ í˜ì´ì§€)
(function(){
  function bindConfirmToShowPage3(){
    const confirmBtn = document.getElementById('thankClose') || document.querySelector('#thankModal button');
    const thankModal = document.getElementById('thankModal');
    const submitBtn = document.getElementById('submitBtn');

    if (!confirmBtn || !thankModal) return false;
    if (confirmBtn.__boundOK) return true;
    confirmBtn.__boundOK = true;

    confirmBtn.addEventListener('click', function(){
      try {
        thankModal.classList.add('hidden');
        if (submitBtn){
          submitBtn.textContent = 'ì œì¶œ ì™„ë£Œ';
          submitBtn.disabled = true;
        }
        const p1 = document.getElementById('page1');
        const p2 = document.getElementById('page2');
        const p3 = document.getElementById('page3');
        if (p1) p1.classList.add('hidden');
        if (p2) p2.classList.add('hidden');
        if (p3) p3.classList.remove('hidden');
        window.scrollTo(0,0);
      } catch(e) {
        console.error('bindConfirmToShowPage3 error:', e);
      }
    });
    return true;
  }

  let cnt = 0;
  const intervalID = setInterval(() => {
    cnt++;
    if (bindConfirmToShowPage3() || cnt > 20) {
      clearInterval(intervalID);
    }
  }, 300);
})();
</script>
</body>
</html>
