<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬(Që°©ë²•ë¡ )</title>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬(Që°©ë²•ë¡ )</title>

<style>
/* ğŸ”½ ê¸°ì¡´ index-fixed-final.htmlì˜ CSS ì „ë¶€ ê·¸ëŒ€ë¡œ ë„£ì–´ì£¼ì„¸ìš” */
</style>

<!-- âœ… í† í° ì¸ì¦ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
const TOKEN_API_URL = "https://script.google.com/macros/s/AKfycbzhxw3kVbBBEJhPGAHXBxoL4S7vZKbqwCK5I5PeaeYEDLIO0u1l2VYwTpAMi-ywRem6og/exec";

// JSONP í˜¸ì¶œ
function jsonp(url, params) {
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Math.random().toString(36).substring(2);
    params.callback = cb;
    const qs = Object.keys(params).map(k => `${k}=${encodeURIComponent(params[k])}`).join("&");
    const script = document.createElement("script");
    script.src = url + "?" + qs;
    window[cb] = function(data) {
      resolve(data);
      document.body.removeChild(script);
      delete window[cb];
    };
    script.onerror = reject;
    document.body.appendChild(script);
  });
}

function getTokenFromURL(){
  const u = new URL(location.href);
  let t = u.searchParams.get('token') || u.searchParams.get('t');
  if (!t && location.hash){
    const m = location.hash.match(/token=([^&]+)/);
    if (m) t = m[1];
  }
  return t || '';
}

async function serverValidateToken(token) {
  return await jsonp(TOKEN_API_URL, { action: 'checkToken', token });
}
async function markTokenUsed(token) {
  return await jsonp(TOKEN_API_URL, { action: 'markUsed', token });
}

document.addEventListener('DOMContentLoaded', async ()=>{
  const token = getTokenFromURL();
  if (!token) {
    document.body.innerHTML = "<h2 style='color:red'>âš  í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ê°œì¸ ì „ìš© ë§í¬ë¡œ ì ‘ì†í•´ ì£¼ì„¸ìš”.</h2>";
    return;
  }
  const statusBox = document.createElement("div");
  statusBox.id = "status";
  statusBox.style.color = "red";
  statusBox.style.margin = "16px";
  statusBox.innerText = "í† í° í™•ì¸ ì¤‘...";
  document.body.prepend(statusBox);

  try {
    const res = await serverValidateToken(token);
    if (!res.ok && res.status==="invalid") {
      statusBox.innerText = "ì˜ëª»ëœ í† í°ì…ë‹ˆë‹¤.";
      return;
    }
    if (res.status==="used") {
      statusBox.innerText = "ì´ë¯¸ ì‚¬ìš©ëœ í† í°ì…ë‹ˆë‹¤.";
      return;
    }
    if (res.status==="valid") {
      statusBox.remove();
      if (typeof initSurvey === "function") initSurvey();  // âœ… ì„¤ë¬¸ ì‹œì‘
    }
  } catch(err) {
    statusBox.innerText = "í† í° ê²€ì¦ ì˜¤ë¥˜: " + err;
  }
});

async function finalizeSurvey(){
  const token = getTokenFromURL();
  await markTokenUsed(token);
}
</script>
</head>
<body>

<header>
  <div class="wrap">
    <h1>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬(Që°©ë²•ë¡ )</h1>
    <div class="sub">
      1ë‹¨ê³„ì—ì„œ ì‘ë‹µì ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ , 2ë‹¨ê³„ì—ì„œ Qì§„ìˆ ë¬¸ ì¹´ë“œë¥¼ ë¶„í¬ì— ë§ê²Œ ë°°ì¹˜í•œ ë’¤ ì œì¶œí•´ ì£¼ì„¸ìš”.<br/>
      ì œê³µí•´ì£¼ì‹  ê°œì¸ì •ë³´ ë° ì‘ë‹µ ê²°ê³¼ëŠ” ì—°êµ¬ì—ë§Œ ì‚¬ìš©ë˜ë©°, ì—°êµ¬ ì¢…ë£Œ ì¦‰ì‹œ íê¸°ë©ë‹ˆë‹¤.
    </div>
  </div>
</header>

<main class="wrap">
  <!-- Page 1: ì‘ë‹µì ì •ë³´ -->
  <section class="page" id="page1">
    <!-- ğŸ”½ ì„ ìƒë‹˜ ì›ë³¸ ì‘ë‹µì ì •ë³´ ì…ë ¥ í¼ ì „ì²´ -->
  </section>

  <!-- Page 2: Q-sort -->
  <section class="page hidden" id="page2">
    <!-- ğŸ”½ 39ê°œ ì§„ìˆ ë¬¸ Q-sort ë³´ë“œ + ì¹´ë“œí’€ ì „ì²´ -->
    <button id="submitBtn">ì œì¶œ</button>
  </section>

  <!-- Page 3: ì œì¶œ ì™„ë£Œ -->
  <section class="page hidden" id="page3">
    <h2>ì œì¶œ ì™„ë£Œ</h2>
    <p>ì„¤ë¬¸ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ê²°ê³¼ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
  </section>
</main>

<script>
// âœ… ì„¤ë¬¸ ì´ˆê¸°í™”
function initSurvey(){
  renderColumns();
  ensureCards();
  setUniformCardSize();
  showPage(1);

  document.getElementById('nextBtn').addEventListener('click', ()=> showPage(2));
  document.getElementById('submitBtn').addEventListener('click', async ()=>{
    const ok = await submitToSheet(); // ì›ë˜ ìˆë˜ Google Sheets ì œì¶œ ë¡œì§
    if(ok){
      await finalizeSurvey();
      showPage(3);
    }
  });
}
</script>

<!-- ğŸ”½ ì„ ìƒë‹˜ ì›ë³¸ index-fixed-final.html ì•ˆì˜ JS ì „ì²´ (STATEMENTS ë°°ì—´, Q-sort ë“œë˜ê·¸/ë“œë¡­, submitToSheet ë“±) -->
<script>
/* ì—¬ê¸°ì— ì›ë³¸ JS ì½”ë“œ ì „ë¶€ ë¶™ì—¬ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤ */
</script>

</body>
</html>

    <style>
    :root{ --bg:#0f172a; --panel:#111827; --card:#1f2937; --muted:#94a3b8; --text:#e5e7eb; --accent:#6366f1; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(15,23,42,.95),rgba(15,23,42,.6));backdrop-filter:blur(8px);border-bottom:1px solid #1f2937}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{font-size:20px;margin:0 0 6px}
    .sub{color:var(--muted);font-size:13px}
    .hidden{display:none}
    button,select,input,textarea{background:var(--card);color:var(--text);border:1px solid #334155;border-radius:10px;padding:10px 12px;font-size:14px}
    button{font-weight:700;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    button:hover{border-color:var(--accent)}
    input,textarea,select{width:100%}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:16px;margin-top:12px}
    #pool,.col{background:var(--panel);border:1px solid #2b3647;border-radius:12px}
    #pool{padding:12px;min-height:220px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .note{font-size:13px;color:var(--muted)}
    .cols{display:grid;gap:10px}
    .row{display:grid;gap:10px;grid-template-columns:repeat(9,1fr)}
    .col{min-height: 80px;padding:8px;display:flex;flex-direction:column}
    .col-header{display:flex;align-items:center;justify-content:space-between;padding:4px 6px;margin-bottom:6px;border-bottom:1px dashed #334155}
    .tag{font-size:12px;color:var(--muted)}
    .cap{font-size:12px}
    .bucket{display:flex;flex-direction:column;gap:6px}
    .card{font-size: 13px; background:var(--card);border:1px solid #334155;border-radius:12px;padding: 8px 10px;cursor:grab;margin-bottom:6px}
    .card.dragging{opacity:.6}
    .col.over{outline:2px dashed var(--accent);outline-offset:-4px}
    .count-ok{color:var(--ok)}
    .count-warn{color:var(--warn)}
    .count-bad{color:var(--bad)}
    .small{font-size:12px}
    .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
    .chip{background:#0b1222;border:1px solid #2b3647;border-radius:999px;padding:2px 8px;font-size:12px}
    .page{max-width:900px;margin:20px auto;padding:16px;background:var(--panel);border:1px solid #2b3647;border-radius:14px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:13px;color:var(--muted);display:block;margin:10px 0 6px}

    /* Gate (token access) */
    #gate { max-width:900px;margin:20px auto;padding:16px;background:var(--panel);border:1px solid #2b3647;border-radius:14px }
    #gate .status { font-size:14px; color: var(--muted); margin-top:8px }

    /* Modal styles */
    .modal.hidden { display: none; }
    .modal { position: fixed; inset: 0; z-index: 1000; }
    .modal__overlay { position:absolute; inset:0; background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
    .modal__content { position:relative; max-width: 720px; margin: 8vh auto; background: var(--panel); border:1px solid #2b3647; border-radius: 12px; padding: 16px; }
</style>
<style>
/* === Responsive width tuning (columns >= card width) === */
:root { --card-w: 240px; }

@media (max-width: 1600px) { :root { --card-w: 220px; } }
@media (max-width: 1440px) { :root { --card-w: 200px; } }
@media (max-width: 1280px) { :root { --card-w: 180px; } }

/* Use almost full viewport width */
.page { max-width: 98vw !important; }

/* Shrink left sidebar when space tight, give all remaining space to board */
.grid { grid-template-columns: clamp(200px, 18vw, 280px) 1fr !important; }

/* Each column at least as wide as a card */
.row { grid-template-columns: repeat(9, minmax(var(--card-w), 1fr)) !important; }

/* Cards fill column width; in the pool they use card width */
#pool .card { width: var(--card-w); }
.col .bucket .card { width: 100%; }

/* Slightly smaller gutters to win horizontal space */
.row { gap: 8px !important; }
.cols { gap: 8px !important; }

/* Modal styles */
.modal.hidden { display: none; }
.modal { position: fixed; inset: 0; z-index: 1000; }
.modal__overlay { position:absolute; inset:0; background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
.modal__content { position:relative; max-width: 720px; margin: 8vh auto; background: var(--panel); border:1px solid #2b3647; border-radius: 12px; padding: 16px; }

</style>
<style>
/* ê°•ì¡°ëœ ë°°ì¹˜ìš”ë ¹ ë²„íŠ¼ */
.help-btn {
  background: #6366f1;
  color: #fff;
  font-weight: bold;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
.help-btn:hover {
  background: #4f46e5;
  transform: scale(1.03);
}
</style>
<style>
/* Board wrapper for Q-sort columns */
.board {
  border: 1px solid #2b3647;
  border-radius: 12px;
  padding: 12px;
  background: var(--panel);
}
</style>
<style>
/* Re-introduce a clear dashed divider between pool and board, without crossing borders */
.grid { position: relative; align-items: start; } /* ensure titles align at top */
.grid::after {
  content: "";
  position: absolute;
  top: 0; bottom: 0;
  left: clamp(200px, 18vw, 280px);
  border-left: 2px dashed #334155;
  pointer-events: none;
  z-index: 1;
}
/* Make the board visually self-contained */
.board { position: relative; overflow: hidden; background: var(--panel); border: 1px solid #2b3647; border-radius: 12px; padding: 12px; }
</style>
<style>
/* Uniform card height based on longest statement */
:root { --card-h: auto; }
.card { height: var(--card-h); overflow:auto; }
</style>
<style>.col-header .tag { color: #ffffff; font-weight: bold; font-size: 15px; }</style>
<style>
/* Ensure vertical scroll in the card pool (poolList) */
#page2 aside #pool #poolList {
  display: block !important;
  max-height: 50vh !important;
  min-height: 240px;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  padding: 8px;               /* keep padding for readability */
  box-sizing: border-box;
  scrollbar-gutter: stable;
}
/* Keep pool cards full width of the list */
#page2 aside #pool #poolList .card {
  width: 100% !important;
}

#submitBtn {
  font-size: 18px;
  font-weight: bold;
  padding: 14px 22px;
  background: var(--accent);
  color: white;
  border-radius: 12px;
  border: none;
}
#submitBtn:hover {
  background: #4338ca;
}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬(Që°©ë²•ë¡ )</h1>
    <div class="sub">
      1ë‹¨ê³„ì—ì„œ ì‘ë‹µì ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ , 2ë‹¨ê³„ì—ì„œ Qì§„ìˆ ë¬¸ ì¹´ë“œë¥¼ ë¶„í¬ì— ë§ê²Œ ë°°ì¹˜í•œ ë’¤ ì œì¶œë¶€íƒë“œë¦½ë‹ˆë‹¤.<br/>
      ì œê³µí•´ì£¼ì‹  ê°œì¸ ì •ë³´ ë° ì‘ë‹µ ê²°ê³¼ëŠ” ì—°êµ¬ì—ë§Œ ì‚¬ìš©ë˜ë©°, ì—°êµ¬ ì¢…ë£Œ ì¦‰ì‹œ íê¸°ë©ë‹ˆë‹¤.
    </div>
  </div>
</header>

<!-- Token gate (ë³´ì•ˆ: í† í° ì†Œì§€ìë§Œ ì ‘ê·¼) -->
<section id="gate" class="wrap">
  <h2 style="margin:0 0 8px">ì ‘ê·¼ ì œí•œë¨</h2>
  <p>í•´ë‹¹ ì„¤ë¬¸ì€ ê°œë³„í™”ëœ ì ‘ì† í† í°ì„ í¬í•¨í•œ ë§í¬ë¡œë§Œ ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>ì˜¬ë°”ë¥¸ ë§í¬ì¸ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
  <div class="status" id="gateStatus">í† í° í™•ì¸ ì¤‘â€¦</div>
</section>

<main class="wrap hidden" id="appRoot">
  <!-- PAGE 1 -->
  <section class="page" id="page1">
    <h2 style="margin:0 0 12px">1ë‹¨ê³„: ì‘ë‹µì ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ ì£¼ì„¸ìš”.</h2>
    <!-- 1) êµì§ ê²½ë ¥ -->
    <div>
      <label for="career">ì„ ìƒë‹˜ì˜ êµì§ ê²½ë ¥ì„ ì„ íƒí•˜ì—¬ ì£¼ì„¸ìš”. *</label>
      <select id="career" required>
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="under5">5ë…„ ë¯¸ë§Œ</option>
        <option value="5to10">5ë…„ ì´ìƒ ~ 10ë…„ ë¯¸ë§Œ</option>
        <option value="10to15">10ë…„ ì´ìƒ ~ 15ë…„ ë¯¸ë§Œ</option>
        <option value="15to20">15ë…„ ì´ìƒ ~ 20ë…„ ë¯¸ë§Œ</option>
        <option value="20to25">20ë…„ ì´ìƒ ~ 25ë…„ ë¯¸ë§Œ</option>
        <option value="25plus">25ë…„ ì´ìƒ</option>
      </select>
    </div>

    <div>
      <label for="schoolLevel">ì„ ìƒë‹˜ê»˜ì„œ í˜„ì¬ ê·¼ë¬´í•˜ê³  ê³„ì‹  í•™êµê¸‰ì„ ì„ íƒí•˜ì—¬ ì£¼ì„¸ìš”. *</label>
      <select id="schoolLevel" required>
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="middle">ì¤‘í•™êµ</option>
        <option value="high">ê³ ë“±í•™êµ</option>
      </select>
    </div>

    <!-- 2) ì°¸ì—¬ ê²½í—˜ ì²´í¬ë°•ìŠ¤ -->
    <div style="margin:14px 0">
      <label>ì„ ìƒë‹˜ê»˜ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ì‘ì—…ì— ì°¸ì—¬í•˜ì‹  ì ì´ ìˆë‚˜ìš”? (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥, ì „í˜€ ì—†ìŒ ì„ íƒ ì‹œ ë‹¤ë¥¸ í•­ëª© ì„ íƒ ë¶ˆê°€) *</label>
      <div class="checkbox-group" id="experience-options">
        <label class="checkbox-item"><input name="experience" type="checkbox" value="curriculumDev"/> êµ­ê°€ìˆ˜ì¤€ ì§€ë¦¬ê³¼ êµìœ¡ê³¼ì • ê°œë°œ ì—°êµ¬</label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="textbookAuth"/> ì§€ë¦¬ê³¼ ê²€Â·ì¸ì • êµê³¼ì„œ ì§‘í•„(ê²€í†  í¬í•¨)</label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="textbookReview"/> ì§€ë¦¬ê³¼ êµê³¼ì„œ ê²€Â·ì¸ì • ì—…ë¬´</label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="materialDev"/> ì§€ë¦¬ê³¼ ê°œì • êµìœ¡ê³¼ì • ê´€ë ¨ êµìˆ˜Â·í•™ìŠµ ë° í‰ê°€ ìë£Œ ê°œë°œ</label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="trainingInstructor"/> ì§€ë¦¬ê³¼ ê°œì • êµìœ¡ê³¼ì • ì„ ë„ êµì› ì—°ìˆ˜ ê°•ì‚¬</label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="curriculumLeader"/> ì§€ë¦¬ê³¼ ê°œì • êµìœ¡ê³¼ì • ì„ ë„ êµì›</label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="plc"/> ì§€ë¦¬ ê´€ë ¨ ì „ë¬¸ì  êµì› í•™ìŠµ ê³µë™ì²´ í™œë™(í•™êµ ì•ˆ, í•™êµ ë°– ëª¨ë‘ í¬í•¨)</label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="other"/> ê¸°íƒ€: <input id="otherExp" placeholder="ì§ì ‘ ì…ë ¥" style="margin-left:6px;flex:1" type="text"/></label>
        <label class="checkbox-item"><input name="experience" type="checkbox" value="none"/> ì „í˜€ ì—†ìŒ</label>
      </div>
    </div>

    <!-- 3) ë©´ë‹´ ì˜í–¥ -->
    <div style="margin:14px 0">
      <label>ì—°êµ¬ìì˜ ì„¤ë¬¸ ë¶„ì„ í›„ ê° ì½”ë“œ ìœ í˜•ì„ ëŒ€í‘œí•˜ëŠ” ì„ ìƒë‹˜ë“¤ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ì˜¨ë¼ì¸(ì¤Œ) ë©´ë‹´ì´ ì§„í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©´ë‹´ ìš”ì²­ ì‹œ ë§ì€ ì°¸ì—¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ìš”ì²­ ì‹œ ë©´ë‹´ ì°¸ì—¬ ê°€ëŠ¥í•˜ì‹­ë‹ˆê¹Œ? *</label>
      <select id="zoomConsent" required>
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="yes">ì°¸ì—¬í•  ì˜í–¥ì´ ìˆìŠµë‹ˆë‹¤.</option>
        <option value="no">ì°¸ì—¬í•  ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤.</option>
      </select>
    </div>

    <!-- 4) ì´ë©”ì¼ & ì „í™”ë²ˆí˜¸ -->
    <div style="margin-top:14px">
      <label for="email">ì´ë©”ì¼ *</label>
      <input id="email" required type="email"/>
    </div>
    <div>
      <label for="phone">í•¸ë“œí° ë²ˆí˜¸ *(ì„¤ë¬¸ ì°¸ì—¬ ê°ì‚¬ ê¸°í”„í‹°ì½˜ ë°œì†¡ìš©)</label>
      <input id="phone"/>
    </div>

    <!-- 5) ì—°êµ¬ ë™ì˜ -->
    <div class="checkbox-group" style="margin-top:12px">
      <label class="checkbox-item"><input id="consent" type="checkbox"/> ì—°êµ¬ ì°¸ì—¬ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
    </div>

    <div class="toolbar">
      <button id="nextBtn">ë‹¤ìŒ (ì •ë ¬ ë‹¨ê³„ë¡œ ì´ë™)</button>
    </div>
  </section>

  <!-- PAGE 2 -->
  <section class="page hidden" id="page2">
    <h2 style="margin:0 0 12px;display:flex;align-items:center;gap:12px;flex-wrap:wrap">2ë‹¨ê³„: ì„ ìƒë‹˜ê»˜ì„œ Qì§„ìˆ ë¬¸ ì¹´ë“œë¥¼ ì½ì–´ë³´ì‹  í›„, ë³¸ì¸ì˜ ìƒê°ì— ë”°ë¼ â€˜ë§¤ìš° ë¹„ë™ì˜â€™ì—ì„œë¶€í„° â€˜ë§¤ìš° ë™ì˜â€™ ì‚¬ì´ì˜ ìœ„ì¹˜ì— ì•Œë§ê²Œ ë°°ì¹˜í•´ ì£¼ì„¸ìš”.<button class="help-btn" id="helpBtn">ğŸ‘‰ Qì§„ìˆ ë¬¸ ë°°ì¹˜ ìš”ë ¹ì„ ë°˜ë“œì‹œ ì½ì–´ì£¼ì„¸ìš”</button></h2>

    <div class="modal hidden" id="helpModal">
      <div class="modal__overlay"></div>
      <div class="modal__content">
        <h3 style="margin-top:0">Qì§„ìˆ ë¬¸ ë°°ì¹˜ ìš”ë ¹</h3>
        <ul style="line-height:1.75">
          <li>ê° ì¹´ë“œì˜ ì§„ìˆ ì€ êµì‚¬ì˜ êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • í•´ì„ê³¼ ê´€ë ¨í•œ êµì‚¬ì˜ ì¸ì‹, íƒœë„ë“¤ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ì¹´ë“œ ë°°ì¹˜ ì „ 39ê°œì˜ ì§„ìˆ ì„ ë¨¼ì € ì½ì–´ì£¼ì„¸ìš”</li>
          <li>ì¹´ë“œ ì§„ìˆ ë¬¸ì— ëŒ€í•œ ì„ ìƒë‹˜ì˜ ë™ì˜, ë¯¸ë™ì˜ ì •ë„ì— ë”°ë¼ ì¹´ë“œë¥¼ ì˜®ê²¨ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.</li>
          <li>ì–‘ ê·¹ë‹¨ì— í•´ë‹¹í•˜ëŠ” ë§¤ìš° ë¹„ë™ì˜, ë§¤ìš° ë™ì˜ í•˜ëŠ” ì§„ìˆ ë¶€í„° ë°°ì¹˜í•˜ì‹œê³  ì¤‘ë¦½(íŒë‹¨ ë³´ë¥˜)ì— í•´ë‹¹í•˜ëŠ” ì§„ìˆ ì„ ë§ˆì§€ë§‰ì— ë°°ì¹˜í•˜ì‹œë©´ ì‘ë‹µí•˜ê¸°ê°€ í¸ë¦¬í•˜ì‹¤ ê²ƒì…ë‹ˆë‹¤.</li>
          <li>ì¹´ë“œ ë°°ì¹˜ë¥¼ ìˆ˜ì •í•˜ê³  ì‹¶ìœ¼ì‹¤ ê²½ìš°, ì˜®ê¸°ì‹¤ ì¹´ë“œë¥¼ ì¹´ë“œ í’€ë¡œ ì˜®ê¸°ì‹œë©´ ë©ë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì§„í–‰í•˜ì‹œê³  ì‹¶ìœ¼ì‹¤ ê²½ìš°, ë¶„í¬ ì´ˆê¸°í™” ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´ ë©ë‹ˆë‹¤.</li>
          <li>ê° ë™ì˜/ë¹„ë™ì˜ ë‹¨ê³„ì— ë°°ì¹˜í•  ìˆ˜ ìˆëŠ” ì¹´ë“œì˜ ìˆ˜ëŠ” ê°•ì œ ì •ê·œ ë¶„í¬ê°€ ì´ë£¨ì–´ì§€ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, ì„ ìƒë‹˜ê»˜ì„œ ë°°ì¹˜í•˜ëŠ” ì¹´ë“œì˜ ìˆ«ìê°€ ë³´ì¼ ê²ƒ ì…ë‹ˆë‹¤.</li>
        </ul>
        <div style="margin:10px 0 14px">
          <div>-4 (ë§¤ìš° ë¹„ë™ì˜) â†’ 2ê°œ</div>
          <div>-3 (ë¹„ë™ì˜) â†’ 3ê°œ</div>
          <div>-2 (ë‹¤ì†Œ ë¹„ë™ì˜) â†’ 4ê°œ</div>
          <div>-1 (ì•½ê°„ ë¹„ë™ì˜) â†’ 6ê°œ</div>
          <div>0 (ì¤‘ë¦½/íŒë‹¨ ë³´ë¥˜) â†’ 9ê°œ</div>
          <div>1 (ì•½ê°„ ë™ì˜) â†’ 6ê°œ</div>
          <div>2 (ë‹¤ì†Œ ë™ì˜) â†’ 4ê°œ</div>
          <div>3 (ë™ì˜) â†’ 3ê°œ</div>
          <div>4 (ë§¤ìš° ë™ì˜) â†’ 2ê°œ</div>
        </div>
        <div style="text-align:right"><button id="helpClose">ë‹«ê¸°</button></div>
      </div>
    </div>

    <div class="grid">
      <aside>
        <h2 style="margin:8px 0 6px;font-size:16px">ì¹´ë“œ í’€(ë¯¸ë°°ì¹˜)</h2>
        <div class="dropzone" data-score="pool" id="pool">
          <div class="note">ì—¬ê¸°ì— ë†“ìœ¼ë©´ ì¹´ë“œê°€ â€˜ë¯¸ë°°ì¹˜â€™ ìƒíƒœê°€ ë©ë‹ˆë‹¤.</div>
          <div class="bucket" id="poolList"></div>
        </div>
        <details style="margin-top:10px">
          <summary>í˜„ì¬ ë°°ì¹˜ ìš”ì•½</summary>
          <div class="small" id="summary" style="margin-top:6px;white-space:pre-wrap"></div>
        </details>
        <div class="toolbar" style="margin-top:16px">
          <button id="resetBtn">ë¶„í¬ ì´ˆê¸°í™”</button>
          <button id="backBtn">ë’¤ë¡œ (ì‘ë‹µì ì •ë³´)</button>
          <button id="submitBtn">ì œì¶œ</button>
        </div>
      </aside>
      <section>
        <h2 style="margin:8px 0 6px;font-size:16px">Qì†ŒíŒ… ë¶„í¬ë„</h2>
        <div class="board">
          <div class="cols">
            <div class="row" id="row"></div>
          </div>
        </div>
      </section>
    </div>

    <div class="modal hidden" id="thankModal">
      <div class="modal__overlay"></div>
      <div class="modal__content">
        <h3>ì„¤ë¬¸ ì œì¶œ ì™„ë£Œ</h3>
        <p>ì„¤ë¬¸ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
        <div style="text-align:right; display:flex; gap:8px; justify-content:flex-end;">
          <button id="thankClose">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
// === Uniform card height ===
function setUniformCardSize(){
  document.querySelectorAll('.card').forEach(c=>{ c.style.height='auto'; });
  let maxH = 0;
  document.querySelectorAll('.card').forEach(c=>{ maxH = Math.max(maxH, c.offsetHeight); });
  if(maxH < 56) maxH = 56;
  document.documentElement.style.setProperty('--card-h', maxH + 'px');
}
window.addEventListener('resize', ()=> setUniformCardSize());

// ===== ì„¤ì •: 39ë¬¸í•­ / 9ì  ì²™ë„ =====
const PRESET_39 = {
  scores:[-4,-3,-2,-1,0,1,2,3,4],
  caps:[  2,  3,  4,  6, 9, 6, 4, 3, 2],
  labels:[
    "-4 (ë§¤ìš° ë¹„ë™ì˜)","-3 (ë¹„ë™ì˜)","-2 (ë‹¤ì†Œ ë¹„ë™ì˜)","-1 (ì•½ê°„ ë¹„ë™ì˜)",
    "0 (ì¤‘ë¦½/íŒë‹¨ ë³´ë¥˜)","1 (ì•½ê°„ ë™ì˜)","2 (ë‹¤ì†Œ ë™ì˜)","3 (ë™ì˜)","4 (ë§¤ìš° ë™ì˜)"
  ]
};
const STATEMENTS = [
  {id:1, text:"ì§€ë¦¬ ìˆ˜ì—…ì—ì„œ ì œì‹œí•˜ëŠ” í•™ìŠµ ëª©í‘œëŠ” í˜„ì‹¤ ì„¸ê³„ì˜ ë³µì¡ì„±ì„ ë“œëŸ¬ë‚´ê¸°ë³´ë‹¤ ë‹¨ìˆœí™”ëœ í‹€ê³¼ êµ¬í˜¸ë¡œ ë°˜ë³µëœë‹¤ê³  ëŠë‚€ë‹¤."},
  {id:2, text:"êµì‚¬ëŠ” í•™ìƒì˜ ì‹¤ì œ ê²½í—˜ë³´ë‹¤ êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œ ì† ì„œìˆ ì´ë‚˜ êµê³¼ì„œ ì˜ˆì‹œì— ë§ì¶”ì–´ ìˆ˜ì—…ì„ ê¾¸ë¦´ ìˆ˜ë°–ì— ì—†ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:3, text:"êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì— ì œì‹œëœ ì„±ì·¨ê¸°ì¤€ì€ ì‹¤ì œ ì§€ë¦¬ í˜„ìƒì„ íƒêµ¬í•˜ê²Œ í•˜ê¸°ë³´ë‹¤ ëª¨ë²” ë‹µì•ˆì„ ì°¾ê²Œ ë§Œë“œëŠ” ê²½í–¥ì´ ê°•í•˜ë‹¤."},
  {id:4, text:"í•™ìƒë“¤ì˜ í•™ìŠµ í™œë™ ì°¸ì—¬ëŠ” ììœ¨ì ì¸ íƒêµ¬ë¼ê¸°ë³´ë‹¤ êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œê°€ ìš”êµ¬í•˜ëŠ” í˜•ì‹ì  ìˆ˜í–‰ìœ¼ë¡œ íë¥¸ë‹¤ê³  ë³¸ë‹¤."},
  {id:5, text:"ì§€ë¦¬ êµìœ¡ì—ì„œ ê°•ì¡°í•˜ëŠ” í•™ìŠµ ëª©í‘œ, ê°œë…ë“¤ì€ í˜„ì‹¤ì˜ ë³µì¡í•œ ë¬¸ì œë‚˜ ê°ˆë“±ì„ ë‹´ì§€ ëª»í•˜ê³ , êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œ, êµê³¼ì„œ ì†ì—ì„œ ì •í•´ì§„ ë¬¸êµ¬ì²˜ëŸ¼ í˜•ì‹ì ìœ¼ë¡œ ë‹¤ë¤„ì§„ë‹¤."},
  {id:6, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì€ í•™ìƒê³¼ êµì‚¬ê°€ ë§ë‹¥ëœ¨ë¦¬ëŠ” êµ¬ì²´ì ì´ê³  ë³µì¡í•œ ì§€ë¦¬ì  ì‚¶ì˜ ë§¥ë½ë³´ë‹¤ëŠ”, êµ­ê°€ ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì™€ í‰ê°€ ê´€ë ¨ ì§€ì¹¨ì— ë” ì¶©ì‹¤í•´ì§ˆ ìˆ˜ë°–ì— ì—†ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:7, text:"ì§€ë¦¬ì  ë¬¸ì œ ë° ìŸì ì€ ë³µì¡í•œ í˜„ì‹¤ ë¬¸ì œë¡œ ë‹¤ë¤„ì§€ê¸°ë³´ë‹¤ ë‹¨ìˆœí•œ ì‚¬ë¡€ì™€ ë„ì‹ìœ¼ë¡œë§Œ ì œì‹œë˜ì–´ ê°„ë‹¨í•˜ê²Œ ë‹¤ë¤„ì§„ë‹¤ê³  ë³¸ë‹¤."},
  {id:8, text:"êµ­ê°€ ìˆ˜ì¤€ì˜ êµìœ¡ê³¼ì •ì˜ ì§€ì‹œëŠ” êµì‚¬ì˜ ì°½ì˜ì  í•´ì„ë³´ë‹¤ëŠ” íšì¼ì ì¸ í™œë™ìœ¼ë¡œ ê·€ê²°ë˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤."},
  {id:9, text:"í•™ìƒë“¤ì€ ì‹¤ì œ ì§€ì—­ ì‚¬íšŒë³´ë‹¤ êµê³¼ì„œ ì•ˆì—ì„œ ì •í˜•í™”ëœ ì§€ë¦¬ì  ê°œë… ë° íƒêµ¬ë¥¼ ë°°ìš°ëŠ” ë° ìµìˆ™í•´ì§„ë‹¤ê³  ëŠë‚€ë‹¤."},
  {id:10, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ê°•ì¡°ë˜ëŠ” ìš©ì–´ë‚˜ ê°œë…ì€ ì‹¤ì œ ì§€ë¦¬ í˜„ìƒê³¼ ì—°ê²°ë˜ê¸°ë³´ë‹¤, êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì™€ êµê³¼ì„œ ì•ˆì—ì„œ ì •í•´ì§„ ë¬¸êµ¬ì™€ ì˜ˆì‹œë¡œë§Œ ë°˜ë³µëœë‹¤."},
  {id:11, text:"ì§€ë¦¬ êµìœ¡ì€ ì¢…ì¢… í•™ìƒì˜ ì‹¤ì œ ì´í•´ë³´ë‹¤, êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì´ ì •í•´ ë†“ì€ ì„±ì·¨ê¸°ì¤€ì´ë‚˜ í‰ê°€ ê¸°ì¤€ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒì— ë” ì¹˜ì¤‘í•˜ê²Œ ëœë‹¤."},
  {id:12, text:"êµ­ê°€ìˆ˜ì¤€ ì„±ì·¨ê¸°ì¤€ì´ ì œì‹œí•˜ëŠ” ëª©í‘œë“¤ì€ í•™ìƒë“¤ì˜ ì‚¶ê³¼ ë¬´ê´€í•œ ì±„ â€˜í•´ì•¼ í•˜ëŠ” ê²ƒâ€™ìœ¼ë¡œë§Œ ë°›ì•„ë“¤ì—¬ì§ˆ ìœ„í—˜ì´ í¬ë‹¤ê³  ë³¸ë‹¤."},
  {id:13, text:"í•™ìƒì˜ í•™ìŠµ ì„±ì·¨ ì—¬ë¶€ê°€ ë£¨ë¸Œë¦­(ì±„ì  ê¸°ì¤€í‘œ)ê³¼ ê°™ì€ í‘œì¤€í™”ëœ í‰ê°€ ì§€í‘œë¡œ ì¸¡ì •ë  ë•Œ, í•™ìƒì€ í•™ìŠµ ë³´ë‹¤ í‰ê°€ ì§€í‘œ ë§ì¶”ê¸°ì— ì§‘ì¤‘í•˜ê²Œ ëœë‹¤ê³  ë³¸ë‹¤."},
  {id:14, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì— ì œì‹œëœ ì§€ë¦¬ í•™ìŠµì˜ ëª©í‘œë“¤ì€ ì •í•´ì§„ ë‹µìœ¼ë¡œë§Œ ì½íˆì§€ ì•Šê³ , êµì‚¬ê°€ ì²˜í•œ ì§€ì—­ì  ë§¥ë½ì´ë‚˜ í•™ìƒë“¤ì˜ ì‚¶ì— ë”°ë¼ ë‹¬ë¦¬ í•´ì„ë  ìˆ˜ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:15, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì— ì œì‹œëœ ì„±ì·¨ê¸°ì¤€ ë‹¬ì„±ì„ ìœ„í•´ í•™ìƒì—ê²Œ ì œê³µí•˜ëŠ” í•™ìŠµ ê²½í—˜ì€ êµê³¼ì„œì—ì„œ ì œì‹œëœ í™œë™ ë¿ë§Œ ì•„ë‹ˆë¼, ì£¼ë³€ ì§€ì—­ì˜ ì§€ë¦¬ í˜„ìƒì´ë‚˜ í•™ìƒ ê²½í—˜ìœ¼ë¡œ ììœ ë¡­ê²Œ í™•ì¥í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:16, text:"êµ­ê°€ê°€ ì •í•œ ì§€ë¦¬ êµìœ¡ì˜ ë‚´ìš©ê³¼ ë°©ë²•ê³¼ ê°™ì€ í‹€ì€ ë¶„ëª… ë¬¸ì„œë¡œì„œ ì¡´ì¬í•˜ì§€ë§Œ, êµì‚¬ê°€ í˜„ì¥ì—ì„œ ì¬êµ¬ì„±í•˜ë©´ì„œ ìƒˆë¡œìš´ ìˆ˜ì—… íë¦„ì„ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆëŠ” ì—¬ì§€ê°€ ì¶©ë¶„í•˜ë‹¤ê³  ë³¸ë‹¤."},
  {id:17, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì—ì„œ ì œì‹œí•˜ëŠ” ì§€ë¦¬ ìˆ˜ì—…ì˜ ëª©í‘œ, ë‚´ìš©, ë°©ë²•ë“¤ì€ êµì‚¬ì™€ í•™ìƒì´ í•¨ê»˜ ì‹¤í—˜í•´ë³´ê³  ë³€í˜•í•  ìˆ˜ ìˆëŠ” ì—´ë¦° ì§€ì ìœ¼ë¡œ ì´í•´ëœë‹¤."},
  {id:18, text:"ì •í˜•í™”ëœ ì„±ì·¨ê¸°ì¤€, í•™ìŠµ ëª©í‘œì¡°ì°¨ë„ êµì‚¬ì˜ ì„ íƒì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ìŠµìœ¼ë¡œ êµ¬í˜„ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì¤‘ìš”í•˜ë‹¤ê³  ë³¸ë‹¤."},
  {id:19, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì— ì—†ëŠ” ì§€ë¦¬ì  ì£¼ì œë¥¼ ë‹¤ë£¨ë”ë¼ë„ í•™ìƒ ì‚¶ê³¼ ì—°ê²°ëœë‹¤ë©´ ì¶©ë¶„íˆ êµìœ¡ê³¼ì •ì˜ ì˜ë¯¸ ì•ˆì— í¬í•¨ëœë‹¤ê³  ì—¬ê¸´ë‹¤."},
  {id:20, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì˜ ì§€ì¹¨ì€ ì§€ë¦¬ êµì‚¬ì—ê²Œ í†µì œì˜ ì¥ì¹˜ì´ë©´ì„œë„ ë™ì‹œì— ì°½ì˜ì  í•´ì„ì˜ ê°€ëŠ¥ì„±ì„ ë‚¨ê²¨ë‘”ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:21, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì€ êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì— ì íŒ ê¸°ì¤€ì„ ê·¸ëŒ€ë¡œ ë”°ë¥´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë¥¼ í•™ìƒë“¤ì˜ ê²½í—˜ ì„¸ê³„ì™€ ì—°ê²°í•˜ëŠ” ê²ƒì´ë¼ê³  ë³¸ë‹¤."},
  {id:22, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œì—ì„œ ì œì‹œí•˜ëŠ” êµìˆ˜â€¤í•™ìŠµ ë° í‰ê°€ ë°©í–¥ì„ ì™„ì „íˆ ë”°ë¥´ì§€ ì•Šë”ë¼ë„, êµì‚¬ê°€ í•™ìƒê³¼ ì§€ì—­ ìƒí™© ë§ê²Œ ì§€ë¦¬ ìˆ˜ì—…ì„ ììœ¨ì ìœ¼ë¡œ ì¬êµ¬ì„±í•˜ì—¬ ì§„í–‰í•˜ëŠ” ê²ƒì€ ì •ë‹¹í•˜ë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:23, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì€ ì§€ë¦¬ êµì‚¬ì—ê²Œ ë‹¨ì¼í•œ ê¸¸ì´ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ê°ˆë˜ì˜ ê¸¸ì„ ì—´ì–´ì£¼ëŠ” ì¶œë°œì ìœ¼ë¡œ ì½íŒë‹¤."},
  {id:24, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ê³¼ ì‹¤ì²œì€ ì–¸ì œë‚˜ ë¬¸ì„œì— ì íŒ ì§€ì‹œë³´ë‹¤ ë” í’ë¶€í•˜ê³  ë‹¤ì–‘í•  ìˆ˜ ìˆë‹¤."},
  {id:25, text:"ì§€ë¦¬ ìˆ˜ì—…ì—ì„œëŠ” êµ­ê°€ìˆ˜ì¤€ì˜ ì„±ì·¨ê¸°ì¤€ë³´ë‹¤ í•™ìƒê³¼ ì§€ì—­ì˜ íŠ¹ìˆ˜ì„±ì„ ë¨¼ì € ê³ ë ¤í•´ì•¼ í•œë‹¤ê³  ë³¸ë‹¤."},
  {id:26, text:"ì§€ë¦¬ ìˆ˜ì—…ì˜ ì˜ë¯¸ëŠ” êµì‚¬, í•™ìƒ, êµì‹¤ í™˜ê²½, ì§€ì—­ ìë£Œê°€ ì–´ë–»ê²Œ ì–´ìš¸ë¦¬ëŠëƒì— ë”°ë¼ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì— êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë° êµê³¼ì—ì„œ ì œì‹œí•œ í•™ìŠµ ìˆœì„œë„ í˜„ì¥ì— ë§ê²Œ ì¬êµ¬ì„±ë  ìˆ˜ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:27, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì •ì—ì„œ ì œì‹œëœ ì§€ë¦¬ êµìœ¡ì˜ ëª©í‘œë“¤ì€ ë‹¨ìˆœí•œ ì§€ì‹ ì „ë‹¬ì„ ë„˜ì–´, êµì‚¬ ìì‹ ì´ ì–´ë–¤ ì¡´ì¬ì¸ì§€ ì„±ì°°í•˜ê²Œ ë§Œë“œëŠ” ê³„ê¸°ë¡œ ì½íŒë‹¤."},
  {id:28, text:"í•™ìƒë“¤ì´ ë°°ìš°ëŠ” ì§€ë¦¬ì  ì§€ì‹, ê¸°ëŠ¥, ê°€ì¹˜â€¤íƒœë„ ë“±ì€ ê²°êµ­ ìê¸° ì‚¶ì„ ëŒì•„ë³´ê²Œ í•˜ëŠ” ë¬¼ìŒì´ ë˜ì–´ì•¼ í•œë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:29, text:"ì§€ë¦¬ ìˆ˜ì—…ì—ì„œ ì œì‹œë˜ëŠ” í•™ìŠµ ëª©í‘œë“¤ì€ ê°ê´€ì  ì§€ë¦¬ì  ì‚¬ì‹¤ì˜ ë‚˜ì—´ì´ ì•„ë‹ˆë¼, í•™ìƒì´ ì–´ë–»ê²Œ ì„¸ê³„ ì†ì— ì‚´ì•„ê°€ê³  ìˆëŠ”ì§€ë¥¼ ë¬»ëŠ” ê³„ê¸°ë¼ê³  ë³¸ë‹¤."},
  {id:30, text:"êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì€ í•™ìƒì˜ ìƒí™œì„¸ê³„ì™€ ì—°ê²°ë  ë•Œ ë¹„ë¡œì†Œ êµìœ¡ì  ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤ê³  ëŠë‚€ë‹¤."},
  {id:31, text:"ì§€ë¦¬ êµìœ¡ì€ êµì‚¬ì™€ í•™ìƒì´ í•¨ê»˜ ì„¸ê³„ì™€ ìê¸° ìì‹ ì„ ì„±ì°°í•˜ëŠ” ì¥ìœ¼ë¡œ ê¸°ëŠ¥í•´ì•¼ í•œë‹¤ê³  ìƒê°í•œë‹¤."},
  {id:32, text:"êµ­ê°€ê°€ ì œì‹œí•˜ëŠ” ì§€ë¦¬ êµìœ¡ì˜ ëª©í‘œëŠ” í•™ìƒì´ ìê¸° ê°€ëŠ¥ì„±ì„ ë°œê²¬í•˜ëŠ” ê¸°íšŒë¡œ ì „í™˜ë  ìˆ˜ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:33, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œê°€ ë§í•˜ëŠ” ì„±ì·¨ê¸°ì¤€ë“¤ì€ ë‹¨ìˆœíˆ ì™¸ì›Œì•¼ í•  ì§€ì‹ì´ ì•„ë‹ˆë¼, ì‚¶ì˜ ë¬¸ì œì™€ ì—°ê²°ë  ë•Œ ì˜ë¯¸ê°€ ìˆë‹¤ê³  ë³¸ë‹¤."},
  {id:34, text:"í•™ìƒì€ ì§€ë¦¬ë¥¼ í†µí•´ ìê¸° ì‚¶ê³¼ ì„¸ê³„ë¥¼ ì§ˆë¬¸í•˜ê³  ëŒ€ë‹µí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ê³  ì—¬ê¸´ë‹¤."},
  {id:35, text:"ì§€ë¦¬ êµìœ¡ì—ì„œ ì¤‘ìš”í•œ ê²ƒì€ ì‚¬ì‹¤ì˜ ì¶•ì ë³´ë‹¤ ìì‹ ì˜ ê²½í—˜ ì†ì—ì„œ ì˜ë¯¸ë¥¼ ë°œê²¬í•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤."},
  {id:36, text:"êµì‚¬ëŠ” í•™ìƒì´ ìˆ˜ë™ì ìœ¼ë¡œ ë°°ìš°ëŠ” ì¡´ì¬ê°€ ì•„ë‹ˆë¼, ìê¸° ì‚¶ì„ ì£¼ì²´ì ìœ¼ë¡œ ì‚´ì•„ê°€ëŠ” ì¡´ì¬ê°€ ë˜ë„ë¡ ë•ëŠ”ë‹¤ê³  ë³¸ë‹¤."},
  {id:37, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë¬¸ì„œë¥¼ ì½ëŠ” ì¼ì€ êµì‚¬ì—ê²Œë„ ìê¸° ì¡´ì¬ë¥¼ ìƒˆë¡­ê²Œ ì´í•´í•˜ëŠ” ê¸°íšŒê°€ ëœë‹¤."},
  {id:38, text:"ì§€ë¦¬ ìˆ˜ì—…ì€ êµì‚¬ì™€ í•™ìƒì´ í•¨ê»˜ ì„¸ê³„ ì†ì—ì„œ ì‚´ì•„ê°€ê³  ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ë“œëŸ¬ë‚´ëŠ” ì¥ì´ë¼ê³  ìƒê°í•œë‹¤."},
  {id:39, text:"êµ­ê°€ìˆ˜ì¤€ êµìœ¡ê³¼ì • ë° êµê³¼ì„œ ì§€ì‹œëŒ€ë¡œë§Œ ì§„í–‰í•˜ëŠ” ìˆ˜ì—…ì€ êµì‚¬ì™€ í•™ìƒì˜ ë°œì „ì„ ë§‰ê¸° ë•Œë¬¸ì—, í° íë¦„ë§Œ ì°¸ê³ í•´ êµì‚¬ê°€ ìƒˆë¡­ê²Œ ìˆ˜ì—…ì„ êµ¬ì„±í•  ë•Œ êµì‚¬ì™€ í•™ìƒ ëª¨ë‘ ì„±ì¥í•  ìˆ˜ ìˆë‹¤."}
];
let cards = JSON.parse(JSON.stringify(STATEMENTS));
let columns = [];
let selectedCardId = null;
let SUBMITTED = false;
let SUBMITTING = false;

const poolList = null; // will be set in initApp
let rowEl = null;
let summaryEl = null;

function showPage(n){
  document.getElementById('page1').classList.toggle('hidden', n!==1);
  document.getElementById('page2').classList.toggle('hidden', n!==2);
}

function validateRespondent(){
  const career = document.getElementById('career').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const schoolLevel = document.getElementById('schoolLevel').value.trim();
  if(!schoolLevel){ alert('í˜„ì¬ ê·¼ë¬´í•˜ê³  ê³„ì‹  í•™êµê¸‰ì„ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  const email = document.getElementById('email').value.trim();
  const zoomConsent = document.getElementById('zoomConsent').value.trim();
  const consent = document.getElementById('consent').checked;
  const checked = [...document.querySelectorAll('#experience-options input[name="experience"]:checked')];
  const otherChecked = checked.some(i=> i.value==='other');
  const otherText = (document.getElementById('otherExp')||{}).value ? document.getElementById('otherExp').value.trim() : '';
  if(!career){ alert('êµì§ ê²½ë ¥ì„ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  if(checked.length===0){ alert('ì‘ì—… ì°¸ì—¬ ê²½í—˜ì„ ìµœì†Œ 1ê°œ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  if(checked.some(i=> i.value==='none') && checked.length>1){ alert('"ì „í˜€ ì—†ìŒ"ì„ ì„ íƒí•œ ê²½ìš° ë‹¤ë¥¸ í•­ëª©ì€ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return false; }
  if(otherChecked && !otherText){ alert('ê¸°íƒ€ë¥¼ ì„ íƒí•˜ì…¨ë‹¤ë©´ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return false; }
  if(!zoomConsent){ alert('ì˜¨ë¼ì¸ ë©´ë‹´ ì°¸ì—¬ ì˜í–¥ì„ ì„ íƒí•˜ì„¸ìš”.'); return false; }
  if(!email){ alert('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.'); return false; }
  if(!phone){ alert('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return false; }
  if(!consent){ alert('ì—°êµ¬ ì°¸ì—¬ ë™ì˜ë¥¼ ì²´í¬í•´ ì£¼ì„¸ìš”.'); return false; }
  return true;
}

function attachNoneExclusive(){
  const expOptions = document.querySelectorAll('#experience-options input[type="checkbox"]');
  const noneOption = document.querySelector('#experience-options input[value="none"]');
  expOptions.forEach(opt=>{
    opt.addEventListener('change', ()=>{
      if(noneOption.checked){ expOptions.forEach(o=>{ if(o!==noneOption) o.checked=false; }); }
      else { if(opt!==noneOption) noneOption.checked=false; }
    });
  });
}

function makeEl(tag, cls){ const e=document.createElement(tag); if(cls) e.className=cls; return e; }
function getBucket(colEl){ return colEl.querySelector('.bucket'); }
function capStatus(col){
  const bucket = getBucket(col.el); if(!bucket) return;
  const used = bucket.children.length;
  const usednum = col.el.querySelector('.usednum'); if(!usednum) return;
  usednum.textContent = used;
  const cls = used===col.cap? 'count-ok' : (used<col.cap? 'count-warn':'count-bad');
  usednum.className = 'usednum ' + cls; col.el.classList.toggle('over', used>col.cap);
}
function refreshAll(){ columns.forEach(capStatus); updateSummary(); }

function createCardEl(card){
  const el = makeEl('div','card'); el.draggable=true; el.dataset.id=card.id;
  el.innerHTML = '<div class="small" style="opacity:.7">#'+card.id+'</div>'+card.text;
  el.addEventListener('dragstart', e=>{ el.classList.add('dragging'); e.dataTransfer.setData('text/plain', String(card.id)); });
  el.addEventListener('dragend', ()=> el.classList.remove('dragging'));
  el.addEventListener('click', ()=>{
    if(selectedCardId===card.id){ selectedCardId=null; el.style.outline=''; return; }
    document.querySelectorAll('.card').forEach(c=> c.style.outline='');
    selectedCardId=card.id; el.style.outline=`2px solid ${getComputedStyle(document.documentElement).getPropertyValue('--accent')}`;
  });
  return el;
}

function ensureCards(){
  const poolListEl = document.getElementById('poolList');
  poolListEl.innerHTML='';
  cards.forEach(c=> poolListEl.appendChild(createCardEl(c)));
  refreshAll();
}

function attachDnD(){
  const zones = document.querySelectorAll('.dropzone');
  zones.forEach(z=>{
    z.addEventListener('dragover', e=>{ e.preventDefault(); z.classList.add('over'); });
    z.addEventListener('dragleave', ()=> z.classList.remove('over'));
    z.addEventListener('drop', e=>{ e.preventDefault(); z.classList.remove('over'); const id=+e.dataTransfer.getData('text/plain'); moveCardTo(id,z); });
    z.addEventListener('click', ()=>{ if(selectedCardId!=null){ moveCardTo(selectedCardId,z); selectedCardId=null; document.querySelectorAll('.card').forEach(c=> c.style.outline=''); }});
  });
}

function moveCardTo(id, zone){
  const cardEl = document.querySelector(`.card[data-id="${id}"]`); if(!cardEl) return;
  const poolListEl = document.getElementById('poolList');
  const targetBucket = zone.id==='pool' ? poolListEl : getBucket(zone);
  if(zone.id!=='pool'){
    const col = columns.find(c=> String(c.score)===zone.dataset.score);
    if(getBucket(zone).children.length>=col.cap){ zone.classList.add('over'); setTimeout(()=> zone.classList.remove('over'), 300); return; }
  }
  targetBucket.appendChild(cardEl); refreshAll(); setUniformCardSize();
}

function updateSummary(){
  const summaryEl = document.getElementById('summary');
  if(!summaryEl) return;
  const lines=[]; columns.forEach(c=>{ const b=getBucket(c.el); const ids=b?[...b.children].map(e=> e.dataset.id):[]; lines.push(`${c.score}: ${ids.join(', ')||'-'}`); });
  const poolIds=[...document.getElementById('poolList').children].map(e=> e.dataset.id); lines.push(`ë¯¸ë°°ì¹˜: ${poolIds.join(', ')||'-'}`); summaryEl.textContent=lines.join('\n');
}

function renderColumns(){
  const rowElLocal = document.getElementById('row');
  rowElLocal.innerHTML=''; columns=[];
  const {scores,caps,labels} = PRESET_39;
  scores.forEach((score,i)=>{
    const col = makeEl('div','col dropzone');
    col.dataset.score = score;
    const head = makeEl('div','col-header');
    const tag = makeEl('div','tag'); tag.textContent = labels[i];
    const cap = makeEl('div','cap'); cap.innerHTML = `í• ë‹¹ <span class="capnum">${caps[i]}</span> / <span class="usednum">0</span>`;
    head.append(tag,cap);
    const bucket = makeEl('div','bucket');
    col.append(head,bucket); rowElLocal.append(col);
    columns.push({score, cap:caps[i], el:col});
  });
  attachDnD(); refreshAll();
}

function initPageHandlers(){
  document.getElementById('nextBtn').addEventListener('click', ()=>{ if(validateRespondent()) showPage(2); });
  document.getElementById('backBtn')?.addEventListener('click', ()=> showPage(1));
  document.getElementById('resetBtn')?.addEventListener('click', ()=>{
    document.querySelectorAll('.col .bucket').forEach(b=>{ [...b.children].forEach(card=> document.getElementById('poolList').appendChild(card)); });
    refreshAll();
  });
  // ë„ì›€ë§ íŒì—…
  const helpBtn = document.getElementById('helpBtn');
  const helpModal = document.getElementById('helpModal');
  const helpClose = document.getElementById('helpClose');
  if (helpBtn && helpModal && helpClose){
    helpBtn.addEventListener('click', ()=> helpModal.classList.remove('hidden'));
    helpClose.addEventListener('click', ()=> helpModal.classList.add('hidden'));
    helpModal.querySelector('.modal__overlay').addEventListener('click', ()=> helpModal.classList.add('hidden'));
  }
  // Enter í‚¤ ë°©ì§€ (page2)
  document.addEventListener('keydown', (e)=>{
    const onPage2 = !document.getElementById('page2').classList.contains('hidden');
    if (onPage2 && e.key === 'Enter') { e.preventDefault(); }
  });
}

// === Google Sheets Integration ===
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzhxw3kVbBBEJhPGAHXBxoL4S7vZKbqwCK5I5PeaeYEDLIO0u1l2VYwTpAMi-ywRem6og/exec";

function collectQsort(){
  const results = [];
  if (Array.isArray(columns)){
    columns.forEach(c => {
      const b = getBucket(c.el);
      const nodes = b ? Array.from(b.children) : [];
      nodes.forEach(node => {
        const id = Number(node.dataset.id);
        if (!Number.isNaN(id)) results.push({ id, score: Number(c.score) });
      });
    });
  }
  return results;
}

async function submitToSheet(){
  const submitBtn = document.getElementById('submitBtn');
  const payload = {
    career: (document.getElementById('career')?.value || "").trim(),
    schoolLevel: (document.getElementById('schoolLevel')?.value || "").trim(),
    experience: Array.from(document.querySelectorAll('input[name="experience"]:checked')).map(el => el.value),
    experienceOther: (document.getElementById('otherExp')?.value || "").trim(),
    zoomConsent: (document.getElementById('zoomConsent')?.value || "").trim(),
    email: (document.getElementById('email')?.value || "").trim(),
    phone: (document.getElementById('phone')?.value || "").trim(),
    qsort: collectQsort(),
    token: CURRENT_TOKEN || ''
  };
  try {
    await fetch(APPS_SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) });
    // ì œì¶œ ì„±ê³µìœ¼ë¡œ ê°„ì£¼ â†’ í† í° ì‚¬ìš© ì²˜ë¦¬(JSONP)
    try { await jsonp(APPS_SCRIPT_URL, { action: 'markUsed', token: CURRENT_TOKEN }); } catch(_){}
    const thankModal = document.getElementById('thankModal');
    if (thankModal) thankModal.classList.remove('hidden');
    return true;
  } catch (err) {
    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    if (submitBtn){ submitBtn.removeAttribute('disabled'); submitBtn.textContent = 'ì œì¶œ'; }
    if (typeof SUBMITTING !== 'undefined') SUBMITTING = false;
    return false;
  }
};
  try {
    await fetch(APPS_SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) });
    const thankModal = document.getElementById('thankModal');
    if (thankModal) thankModal.classList.remove('hidden');
    return true;
  } catch (err) {
    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    if (submitBtn){ submitBtn.removeAttribute('disabled'); submitBtn.textContent = 'ì œì¶œ'; }
    if (typeof SUBMITTING !== 'undefined') SUBMITTING = false;
    return false;
  }
}

function bindSubmit(){
  document.getElementById('submitBtn').addEventListener('click', ()=>{
    if (SUBMITTING) return;
    SUBMITTING = true;
    const submitBtn = document.getElementById('submitBtn');
    if (submitBtn){ submitBtn.setAttribute('disabled','true'); submitBtn.textContent = 'ì œì¶œ ì¤‘...'; }
    const unmet = columns.filter(c=> getBucket(c.el).children.length !== c.cap);
    if(unmet.length>0){
      alert('ë¶„í¬ ìš©ëŸ‰ì„ ì •í™•íˆ ë§ì¶° ì£¼ì„¸ìš”.');
      SUBMITTING = false;
      if (submitBtn){ submitBtn.removeAttribute('disabled'); submitBtn.textContent = 'ì œì¶œ'; }
      return;
    }
    submitToSheet();
  });
}

(function thankModalToPage3(){
  function bindConfirmToShowPage3(){
    const confirmBtn = document.getElementById('thankClose') || document.querySelector('#thankModal button');
    const thankModal = document.getElementById('thankModal');
    const submitBtn = document.getElementById('submitBtn');
    if (!confirmBtn || !thankModal) return false;
    if (confirmBtn.__boundOK) return true;
    confirmBtn.__boundOK = true;
    confirmBtn.addEventListener('click', function(){
      try {
        thankModal.classList.add('hidden');
        if (submitBtn){ submitBtn.textContent = 'ì œì¶œ ì™„ë£Œ'; submitBtn.disabled = true; }
        const p1 = document.getElementById('page1');
        const p2 = document.getElementById('page2');
        const p3 = document.getElementById('page3');
        if (p1) p1.classList.add('hidden');
        if (p2) p2.classList.add('hidden');
        if (p3) p3.classList.remove('hidden');
        window.scrollTo(0,0);
      } catch(e) { console.error('bindConfirmToShowPage3 error:', e); }
    });
    return true;
  }
  let cnt = 0;
  const intervalID = setInterval(() => {
    cnt++;
    if (bindConfirmToShowPage3() || cnt > 20) { clearInterval(intervalID); }
  }, 300);
})();
</script>

<section class="page hidden" id="page3">
  <h2>ì œì¶œ ì™„ë£Œ</h2>
  <p>ì„¤ë¬¸ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ê²°ê³¼ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
</section>

<script>
// === ì¹´ë“œ í’€ ì •ë ¬ ìœ ì§€ ===
(function(){
  function getCardId(el){
    if (!el) return Number.MAX_SAFE_INTEGER;
    if (el.dataset && el.dataset.id !== undefined && el.dataset.id !== "") {
      var n = Number(el.dataset.id);
      if (!Number.isNaN(n)) return n;
    }
    var m = (el.textContent || "").match(/#\s*(\d+)/);
    return m ? Number(m[1]) : Number.MAX_SAFE_INTEGER;
  }
  var sorting = false;
  function sortPoolAscending(){
    if (sorting) return;
    var pool = document.getElementById('poolList');
    if (!pool) return;
    sorting = true;
    var nodes = Array.prototype.slice.call(pool.children);
    nodes.sort(function(a,b){ return getCardId(a) - getCardId(b); });
    nodes.forEach(function(n){ pool.appendChild(n); });
    sorting = false;
  }
  document.addEventListener('DOMContentLoaded', function(){
    var pool = document.getElementById('poolList');
    if (!pool) return;
    sortPoolAscending();
    var timer = null;
    var obs = new MutationObserver(function(){
      if (sorting) return;
      if (timer) clearTimeout(timer);
      timer = setTimeout(sortPoolAscending, 0);
    });
    obs.observe(pool, { childList: true });
  });
})();
</script>

<!-- === Token Validation Gate === -->
<script>
/**
 * ê°„ë‹¨í•œ í† í° ê²Œì´íŠ¸(í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
 * - ë°°í¬ ì‹œ, ê° ì‘ë‹µìì—ê²Œ ?t=ê°œë³„í† í° í˜•íƒœì˜ URLì„ ë°œê¸‰í•˜ì„¸ìš”.
 * - ì•„ë˜ LOCAL_ALLOWED_TOKENSì— í—ˆìš© í† í°ì„ ë„£ìœ¼ë©´(ê¶Œì¥), í•´ë‹¹ í† í°ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
 * - ë˜ëŠ” Google Apps Scriptì—ì„œ action=validateë¥¼ êµ¬í˜„í•´ ì„œë²„ ê²€ì¦ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
 *   ì˜ˆ: GET `${APPS_SCRIPT_URL}?action=validate&token=...` ê°€ `{ ok: true }` ë°˜í™˜
 *
 * âš ï¸ ì£¼ì˜: HTML ë‚´ë¶€ì— í† í° ëª©ë¡ì„ ë‘ëŠ” ë°©ì‹ì€ ê°•í•œ ë³´ì•ˆì´ ì•„ë‹™ë‹ˆë‹¤. ë§í¬ ìœ ì¶œ ë°©ì§€ìš© 1ì°¨ ì¥ì¹˜ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.
 */
const LOCAL_ALLOWED_TOKENS = [
  // ì˜ˆì‹œ: "TCH-001-9b2e", "TCH-002-17aa"
];

function getTokenFromURL(){
  const href = String(location.href);
  const u = new URL(href);
  // 1) ì¿¼ë¦¬ì—ì„œ ìš°ì„  ì¶”ì¶œ
  let t = u.searchParams.get('token') || u.searchParams.get('t') || '';
  if (t) return t;
  // 2) í•´ì‹œ(#)ì— ë¶™ì—¬ì˜¨ ê²½ìš°ë„ í—ˆìš©: #token=... ë˜ëŠ” #t=...
  const h = (location.hash || '').replace(/^#/, '');
  if (h) {
    const params = new URLSearchParams(h);
    t = params.get('token') || params.get('t') || '';
    if (t) return t;
    // ë‹¨ì¼ê°’ í˜•íƒœ(#abcd1234)ë¡œ ì˜¨ ê²½ìš°ë„ í—ˆìš©(ì˜ìˆ«ì 6~32)
    if (/^[A-Za-z0-9_-]{6,32}$/.test(h)) return h;
  }
  return '';
}

// JSONP ìœ í‹¸(Apps Script CORS íšŒí”¼)
function jsonp(url, params={}){
  return new Promise((resolve)=>{
    const cbName = 'cb_' + Math.random().toString(36).slice(2);
    params.callback = cbName;
    const qs = Object.entries(params).map(([k,v])=> `${encodeURIComponent(k)}=${encodeURIComponent(v)}`).join('&');
    const script = document.createElement('script');
    window[cbName] = (data)=>{ try{ resolve(data); } finally { delete window[cbName]; script.remove(); } };
    script.src = `${url}?${qs}`;
    document.head.appendChild(script);
  });
}
async function serverValidateToken(token){
  const data = await jsonp(APPS_SCRIPT_URL, { action: 'checkToken', token });
  // ê¸°ëŒ€ ì‘ë‹µ: { ok:true, status:"valid"|"used" } ë˜ëŠ” { ok:false, status:"invalid" }
  return data;
}?action=validate&token=${encodeURIComponent(token)}`);
    if (!res.ok) return false;
    const data = await res.json();
    return !!(data && (data.ok === true || data.valid === true));
  } catch(e){ return false; }
}

let CURRENT_TOKEN = '';
async function checkAccess(){
  const gate = document.getElementById('gate');
  const status = document.getElementById('gateStatus'); const debug = (msg)=>{ if(status) status.textContent = msg; };
  const app = document.getElementById('appRoot');
  const token = getTokenFromURL();
  CURRENT_TOKEN = token;
  if (!token){
    status.textContent = 'ì ‘ì† í† í°ì´ í¬í•¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.';
    gate.classList.remove('hidden');
    app.classList.add('hidden');
    return false;
  }
  // 1) ë¡œì»¬ í—ˆìš© ëª©ë¡ ìš°ì„ 
  if (LOCAL_ALLOWED_TOKENS.length > 0){
    if (LOCAL_ALLOWED_TOKENS.includes(token)){
      gate.classList.add('hidden'); app.classList.remove('hidden'); initApp(); return true;
    } else {
      status.textContent = 'ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤. ë§í¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.';
      gate.classList.remove('hidden'); app.classList.add('hidden'); return false;
    }
  }
  // 2) ì„œë²„ ê²€ì¦(JSONP)
  status.textContent = 'í† í°ì„ í™•ì¸í•˜ëŠ” ì¤‘â€¦';
  const resp = await serverValidateToken(token);
  if (resp && resp.ok && resp.status === 'valid'){
    gate.classList.add('hidden'); app.classList.remove('hidden'); initApp(); return true;
  }
  if (resp && resp.ok && resp.status === 'used'){
    status.textContent = 'ì´ë¯¸ ì‚¬ìš©ëœ í† í°ì…ë‹ˆë‹¤. ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.';
  } else {
    status.textContent = 'ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤. ë§í¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.';
  }
  gate.classList.remove('hidden'); app.classList.add('hidden');
  return false;
}
  // 1) ë¡œì»¬ í—ˆìš© ëª©ë¡ ìš°ì„ 
  if (LOCAL_ALLOWED_TOKENS.length > 0){
    if (LOCAL_ALLOWED_TOKENS.includes(token)){
      gate.classList.add('hidden');
      app.classList.remove('hidden');
      initApp();
      return true;
    } else {
      status.textContent = 'ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤. ë§í¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.';
      gate.classList.remove('hidden');
      app.classList.add('hidden');
      return false;
    }
  }
  // 2) ì„œë²„ ê²€ì¦ (ì„ íƒ ì‚¬í•­)
  status.textContent = 'ì„œë²„ì—ì„œ í† í°ì„ í™•ì¸í•˜ëŠ” ì¤‘â€¦';
  const ok = await serverValidateToken(token);
  if (ok){
    gate.classList.add('hidden');
    app.classList.remove('hidden');
    initApp();
    return true;
  } else {
    status.textContent = 'ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤. ë§í¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.';
    gate.classList.remove('hidden');
    app.classList.add('hidden');
    return false;
  }
}

function initApp(){
  // ì´ˆê¸° ë Œë”ë§ ë° ì´ë²¤íŠ¸ ë°”ì¸ë”©
  renderColumns();
  ensureCards();
  setUniformCardSize();
  showPage(1);
  initPageHandlers();
  attachNoneExclusive();
  bindSubmit();
}

// ë¶€íŒ…
document.addEventListener('DOMContentLoaded', checkAccess);
</script>
</body>
</html>
