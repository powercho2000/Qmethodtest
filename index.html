<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬(Që°©ë²•ë¡ )</title>
    <style>
        /* ê¸°ì¡´ CSS ì½”ë“œ */
        :root{ --bg:#0f172a; --panel:#111827; --card:#1f2937; --muted:#94a3b8; --text:#e5e7eb; --accent:#6366f1; --ok:#22c5e; --warn:#f59e0b; --bad:#ef4444; }
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
        header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(15,23,42,.95),rgba(15,23,42,.6));backdrop-filter:blur(8px);border-bottom:1px solid #1f2937}
        .wrap{max-width:1200px;margin:0 auto;padding:16px}
        h1{font-size:20px;margin:0 0 6px}
        .sub{color:var(--muted);font-size:13px}
        .hidden{display:none}
        button,select,input,textarea{background:var(--card);color:var(--text);border:1px solid #334155;border-radius:10px;padding:10px 12px;font-size:14px}
        button{font-weight:700;cursor:pointer}
        button[disabled]{opacity:.6;cursor:not-allowed}
        button:hover{border-color:var(--accent)}
        input,textarea,select{width:100%}
        .grid{display:grid;grid-template-columns:320px 1fr;gap:16px;margin-top:12px}
        #pool,.col{background:var(--panel);border:1px solid #2b3647;border-radius:12px}
        #pool{padding:12px;min-height:220px}
        .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
        .note{font-size:13px;color:var(--muted)}
        .cols{display:grid;gap:10px}
        .row{display:grid;gap:10px;grid-template-columns:repeat(9,1fr)}
        .col{min-height: 80px;padding:8px;display:flex;flex-direction:column}
        .col-header{display:flex;align-items:center;justify-content:space-between;padding:4px 6px;margin-bottom:6px;border-bottom:1px dashed #334155}
        .tag{font-size:12px;color:var(--muted)}
        .cap{font-size:12px}
        .bucket{display:flex;flex-direction:column;gap:6px}
        .card{font-size: 13px; background:var(--card);border:1px solid #334155;border-radius:12px;padding: 8px 10px;cursor:grab;margin-bottom:6px}
        .card.dragging{opacity:.6}
        .col.over{outline:2px dashed var(--accent);outline-offset:-4px}
        .count-ok{color:var(--ok)}
        .count-warn{color:var(--warn)}
        .count-bad{color:var(--bad)}
        .small{font-size:12px}
        .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
        .chip{background:#0b1222;border:1px solid #2b3647;border-radius:999px;padding:2px 8px;font-size:12px}
        .page{max-width:900px;margin:20px auto;padding:16px;background:var(--panel);border:1px solid #2b3647;border-radius:14px}
        .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        label{font-size:13px;color:var(--muted);display:block;margin:10px 0 6px}
        /* ì²´í¬ë°•ìŠ¤ ë¼ë²¨ ì •ë ¬/ê°„ê²© */
        .checkbox-group{display:flex;flex-direction:column;gap:8px;margin-top:8px}
        .checkbox-item{display:flex;align-items:center;gap:8px}
        .checkbox-item input[type="checkbox"]{width:16px;height:16px;margin:0;vertical-align:middle}
      
        /* Modal styles */
        .modal.hidden { display: none; }
        .modal { position: fixed; inset: 0; z-index: 1000; }
        .modal__overlay { position:absolute; inset:0; background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
        .modal__content { position:relative; max-width: 720px; margin: 8vh auto; background: var(--panel); border:1px solid #2b3647; border-radius: 12px; padding: 16px; }

        #poolContainer {
            border-right: 1px dashed #ccc; /* ì¹´ë“œí’€ê³¼ ë¶„í¬ë„ ì‚¬ì´ì˜ êµ¬ë¶„ì„  */
        }
        #poolList {
            display: block;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 8px;
            width: 100%;
            box-sizing: border-box;
            scrollbar-gutter: stable;  /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ í™•ë³´ */
        }
        #poolList .card {
            display: block;
            width: 100%;               /* ì¹´ë“œ í­ ê·¸ëŒ€ë¡œ */
            margin-bottom: 8px;
        }

        #submitBtn {
          font-size: 18px;
          font-weight: bold;
          padding: 14px 22px;
          background: var(--accent);
          color: white;
          border-radius: 12px;
          border: none;
        }
        #submitBtn:hover {
          background: #4338ca;
        }
        /* === Responsive width tuning (columns >= card width) === */
        :root { --card-w: 240px; }

        @media (max-width: 1600px) { :root { --card-w: 220px; } }
        @media (max-width: 1440px) { :root { --card-w: 200px; } }
        @media (max-width: 1280px) { :root { --card-w: 180px; } }

        /* Use almost full viewport width */
        .page { max-width: 98vw !important; }

        /* Shrink left sidebar when space tight, give all remaining space to board */
        .grid { grid-template-columns: clamp(200px, 18vw, 280px) 1fr !important; }

        /* Each column at least as wide as a card */
        .row { grid-template-columns: repeat(9, minmax(var(--card-w), 1fr)) !important; }

        /* Cards fill column width; in the pool they use card width */
        #pool .card { width: var(--card-w); }
        .col .bucket .card { width: 100%; }

        /* Slightly smaller gutters to win horizontal space */
        .row { gap: 8px !important; }
        .cols { gap: 8px !important; }

        /* ì¶”ê°€ëœ ìƒíƒœ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .status-message {
            margin-top: 50px;
            padding: 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text);
            background: var(--panel);
            border-radius: 12px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid var(--accent);
        }
        .status-message.error {
            color: var(--bad);
            border-color: var(--bad);
        }
        .status-message.info {
            color: var(--accent);
            border-color: var(--accent);
        }
        .status-message.success {
            color: var(--ok);
            border-color: var(--ok);
        }
    </style>
</head>
<body>
    <header>
        <div class="wrap">
            <h1>êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ì„ í†µí•œ ì˜ë¯¸ êµ¬ì„±ì˜ ì½”ë“œ ìœ í˜• íƒêµ¬ (Që°©ë²•ë¡ )</h1>
            <div class="sub">ë³¸ ì„¤ë¬¸ì€ êµì‚¬ì˜ êµìœ¡ê³¼ì • í•´ì„ ìœ í˜•ì„ íƒìƒ‰í•˜ëŠ” ì—°êµ¬ì…ë‹ˆë‹¤.</div>
        </div>
    </header>

    <!-- í† í° ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
    <div id="status-message" class="status-message info">
        ì„¤ë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...
    </div>

    <!-- ì‹¤ì œ ì„¤ë¬¸ ì½˜í…ì¸  (í† í° ìœ íš¨ì„± ê²€ì¦ í›„ í‘œì‹œ) -->
    <div id="survey-main-content" class="hidden">
        <form id="q-sort-form">
            <!-- ì¡°ê²½ì² 2577ë‹˜ê»˜ì„œ ìš”ì²­í•˜ì‹  Q-ì§„ìˆ ë¬¸ ë¶„ë¥˜ ë¶€ë¶„ë§Œ ë‚¨ê¹ë‹ˆë‹¤. -->
            <!-- ì´ì „ì— ì œê°€ ì„ì˜ë¡œ ì¶”ê°€í–ˆë˜ ì¸êµ¬ í†µê³„ ì •ë³´ëŠ” ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. -->

            <div class="page">
                <h2>Q-ì§„ìˆ ë¬¸ ë¶„ë¥˜ (ì¹´ë“œ ë¶„ë¥˜)</h2>
                <p class="note">ì•„ë˜ 35ê°œ ì§„ìˆ ë¬¸ì„ ê°€ì¥ ë™ì˜í•˜ëŠ” ê²ƒë¶€í„° ë™ì˜í•˜ì§€ ì•ŠëŠ” ê²ƒê¹Œì§€ [-4] ì—ì„œ [+4] ìŠ¤ì¼€ì¼ì— ë§ì¶° ë¶„í¬í‘œì— ë¶„ë¥˜í•´ì£¼ì„¸ìš”.</p>

                <div class="grid">
                    <div id="poolContainer">
                        <h3><span id="poolCount" class="count-ok">0</span>ê°œ ë‚¨ìŒ</h3>
                        <p class="note">ì—¬ê¸°ì— ë¶„ë¥˜í•  ì¹´ë“œë“¤ì´ ìˆìŠµë‹ˆë‹¤.</p>
                        <div id="poolList">
                            <!-- Q-Cards will be loaded here -->
                        </div>
                    </div>

                    <div id="sortGrid">
                        <h3>ë¶„í¬í‘œ</h3>
                        <div class="toolbar">
                            <div class="chips">
                                <span class="chip">ë§¤ìš° ë¶€ì • [-4]</span>
                                <span class="chip">ë‹¤ì†Œ ë¶€ì • [-2]</span>
                                <span class="chip">ì¤‘ë¦½ [0]</span>
                                <span class="chip">ë‹¤ì†Œ ê¸ì • [+2]</span>
                                <span class="chip">ë§¤ìš° ê¸ì • [+4]</span>
                            </div>
                        </div>

                        <div class="cols">
                            <div class="row">
                                <div class="col" data-score="-4"><div class="col-header small"><span class="tag">-4</span> <span class="cap">2ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="-3"><div class="col-header small"><span class="tag">-3</span> <span class="cap">3ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="-2"><div class="col-header small"><span class="tag">-2</span> <span class="cap">5ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="-1"><div class="col-header small"><span class="tag">-1</span> <span class="cap">6ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="0"><div class="col-header small"><span class="tag">0</span> <span class="cap">7ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="1"><div class="col-header small"><span class="tag">+1</span> <span class="cap">6ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="2"><div class="col-header small"><span class="tag">+2</span> <span class="cap">5ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="3"><div class="col-header small"><span class="tag">+3</span> <span class="cap">3ê°œ</span></div><div class="bucket"></div></div>
                                <div class="col" data-score="4"><div class="col-header small"><span class="tag">+4</span> <span class="cap">2ê°œ</span></div><div class="bucket"></div></div>
                            </div>
                        </div>
                        <p class="note">ê° ì¹¸ì— ì§€ì •ëœ ê°œìˆ˜ë§Œí¼ ì¹´ë“œë¥¼ ë¶„ë¥˜í•´ì£¼ì„¸ìš”. ìˆ«ìëŠ” ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
                        <div style="text-align:center; margin-top:20px;">
                            <button type="submit" id="submitBtn">ì„¤ë¬¸ ì œì¶œ ì™„ë£Œ</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- JavaScript ë¡œì§ -->
    <script>
        // ğŸš¨ í† í° ê´€ë¦¬ (í™•ì¸ ë° ì‚¬ìš© ì²˜ë¦¬) Apps Script ì›¹ ì•± URL
        const TOKEN_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzhxw3kVbBBEJhPGAHXBxoL4S7vZKbqwCK5I5PeaeYEDLIO0u1l2VYwTpAMi-ywRem6og/exec";
        // ğŸš¨ Që°©ë²•ë¡  ì‘ë‹µ ê²°ê³¼ê°€ ì €ì¥ë˜ëŠ” Apps Script ì›¹ ì•± URL (doPost í•„ìš”)
        const Q_SURVEY_DATA_SUBMIT_URL = "https://script.google.com/macros/s/AKfycbxr3fORzxqC94mS_KAWSeL_NFwzIctrus9ntJSfHjofSUMNqTmH7Pb7fZfqeLoQMRNwdA/exec";

        const statusMessageDiv = document.getElementById('status-message');
        const surveyMainContent = document.getElementById('survey-main-content');
        const qSortForm = document.getElementById('q-sort-form');
        let currentToken = ''; // í˜„ì¬ í† í° ì €ì¥

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ íŠ¹ì • ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Apps Script ì›¹ ì•±ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ëŠ” í•¨ìˆ˜
        async function callAppsScript(url, action, token) {
            const fullUrl = `${url}?action=${action}&token=${encodeURIComponent(token)}`;
            try {
                const response = await fetch(fullUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error(`Apps Script (${action}) í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
                return { ok: false, status: "error", message: "ì„œë²„ í†µì‹  ì˜¤ë¥˜" };
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ê²€ì¦ ë¡œì§ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async () => {
            currentToken = getUrlParameter('token');

            if (!currentToken) {
                statusMessageDiv.className = 'status-message error';
                statusMessageDiv.innerHTML = 'ìœ íš¨í•œ ì„¤ë¬¸ í† í°ì´ URLì— í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.';
                return;
            }

            // í† í° ìœ íš¨ì„± ê²€ì¦
            statusMessageDiv.className = 'status-message info';
            statusMessageDiv.innerHTML = 'í† í°ì„ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...';
            const checkResult = await callAppsScript(TOKEN_WEB_APP_URL, 'checkToken', currentToken);

            if (!checkResult.ok) {
                statusMessageDiv.className = 'status-message error';
                statusMessageDiv.innerHTML = `í† í° í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${checkResult.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
            } else {
                if (checkResult.status === 'valid') {
                    // ìœ íš¨í•œ í† í°, ì„¤ë¬¸ í‘œì‹œ
                    statusMessageDiv.classList.add('hidden'); // ìƒíƒœ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                    surveyMainContent.classList.remove('hidden'); // ì„¤ë¬¸ ë‚´ìš© ë³´ì´ê¸°
                    initializeQSorting(); // Q-Sorting ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
                } else if (checkResult.status === 'used') {
                    // ì´ë¯¸ ì‚¬ìš©ëœ í† í°
                    statusMessageDiv.className = 'status-message info';
                    statusMessageDiv.innerHTML = 'ì´ë¯¸ ì´ í† í°ìœ¼ë¡œ ì„¤ë¬¸ì— ì°¸ì—¬í•˜ì…¨ìŠµë‹ˆë‹¤. ì¤‘ë³µ ì°¸ì—¬ëŠ” ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.';
                } else if (checkResult.status === 'invalid') {
                    // ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í† í°
                    statusMessageDiv.className = 'status-message error';
                    statusMessageDiv.innerHTML = 'ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì„¤ë¬¸ í† í°ì…ë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì£¼ì†Œë¡œ ì ‘ì†í•´ ì£¼ì„¸ìš”.';
                } else {
                    statusMessageDiv.className = 'status-message error';
                    statusMessageDiv.innerHTML = 'ì•Œ ìˆ˜ ì—†ëŠ” í† í° ìƒíƒœì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.';
                }
            }
        });

        // ì„¤ë¬¸ ì œì¶œ ì‹œ í† í° ì‚¬ìš© ì²˜ë¦¬ (markUsed)
        qSortForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // í¼ì˜ ê¸°ë³¸ ì œì¶œ ë™ì‘ ë°©ì§€

            // Q ë¶„ë¥˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘
            const qSortingResults = collectQSortingResults();
            if (!qSortingResults) return; // Q ë¶„ë¥˜ ê²°ê³¼ ìˆ˜ì§‘ ì‹¤íŒ¨ ë˜ëŠ” ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨

            // ì¸êµ¬ í†µê³„ ì •ë³´ê°€ ì—†ìœ¼ë¯€ë¡œ generalDataëŠ” ë¹ˆ ê°ì²´ë¡œ ì „ì†¡
            const generalData = {};
            
            console.log("Q ë¶„ë¥˜ ì„¤ë¬¸ ë°ì´í„° ì œì¶œ ì‹œë„:", generalData, qSortingResults);
            
            statusMessageDiv.classList.remove('hidden'); // ìƒíƒœ ë©”ì‹œì§€ ì˜ì—­ ë‹¤ì‹œ ë³´ì´ê²Œ
            statusMessageDiv.className = 'status-message info';
            statusMessageDiv.innerHTML = 'ì„¤ë¬¸ ë‚´ìš©ì„ ì œì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            surveyMainContent.classList.add('hidden'); // ì„¤ë¬¸ ë‚´ìš© ìˆ¨ê¸°ê¸°

            try {
                // 1. Që°©ë²•ë¡  ì‘ë‹µ ê²°ê³¼ ë°ì´í„°ë¥¼ Q_SURVEY_DATA_SUBMIT_URLë¡œ POST ì „ì†¡
                const response = await fetch(Q_SURVEY_DATA_SUBMIT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ token: currentToken, general: generalData, qSort: qSortingResults }),
                    headers: { 'Content-Type': 'text/plain' } // Apps ScriptëŠ” 'application/json' ëŒ€ì‹  'text/plain'ì„ ì„ í˜¸
                });
                const responseData = await response.json();

                if (!responseData.ok) {
                    throw new Error(responseData.message || 'ì„¤ë¬¸ ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                // 2. ì„¤ë¬¸ ë°ì´í„° ì €ì¥ ì„±ê³µ í›„, í† í° ì‚¬ìš© ì™„ë£Œ ì²˜ë¦¬ (TOKEN_WEB_APP_URL ì‚¬ìš©)
                const markUsedResult = await callAppsScript(TOKEN_WEB_APP_URL, 'markUsed', currentToken);

                if (markUsedResult.ok) {
                    statusMessageDiv.className = 'status-message success';
                    statusMessageDiv.innerHTML = 'ì„¤ë¬¸ ì‘ë‹µì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆê³ , í† í°ì´ ì‚¬ìš© ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤!';
                } else {
                    statusMessageDiv.className = 'status-message error';
                    statusMessageDiv.innerHTML = `ì„¤ë¬¸ ë°ì´í„°ëŠ” ì €ì¥ë˜ì—ˆì§€ë§Œ, í† í° ì‚¬ìš© ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${markUsedResult.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.`;
                    console.error("markUsed ì‹¤íŒ¨:", markUsedResult);
                }
            } catch (error) {
                console.error("ì„¤ë¬¸ ë°ì´í„° ì „ì†¡ ë˜ëŠ” í† í° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                statusMessageDiv.className = 'status-message error';
                statusMessageDiv.innerHTML = `ì„¤ë¬¸ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.`;
            }
        });
        
        // ì¸êµ¬ í†µê³„ ì •ë³´ê°€ ì—†ìœ¼ë¯€ë¡œ validateGeneralForm í•¨ìˆ˜ëŠ” í•„ìš” ì—†ìœ¼ë‚˜,
        // í˜¹ì‹œ ë‚˜ì¤‘ì— ì¶”ê°€í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ì£¼ì„ ì²˜ë¦¬í•˜ê±°ë‚˜ ì œê±° ê°€ëŠ¥
        /*
        function validateGeneralForm(generalData) {
            // í˜„ì¬ ì¼ë°˜ í¼ ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ í•­ìƒ true ë°˜í™˜
            return true;
        }
        */

        // --- Q-Sorting ê´€ë ¨ JavaScript í•¨ìˆ˜ (initializeQSorting ë“±) ---
        function initializeQSorting() {
            console.log("Q-Sorting ê¸°ëŠ¥ ì´ˆê¸°í™” ì¤‘...");
            
            const qStatements = [
                { id: 'q1', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì˜ í¥ë¯¸ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ë°˜ì˜í•´ì•¼ í•œë‹¤.' },
                { id: 'q2', text: 'êµìœ¡ê³¼ì •ì€ ì‚¬íšŒì  ìš”êµ¬ì™€ ë¯¸ë˜ ë³€í™”ì— ë¹ ë¥´ê²Œ ëŒ€ì‘í•´ì•¼ í•œë‹¤.' },
                { id: 'q3', text: 'êµì‚¬ëŠ” êµìœ¡ê³¼ì •ì„ ìì‹ ì˜ êµìœ¡ ì² í•™ì— ë”°ë¼ ììœ ë¡­ê²Œ ì¬êµ¬ì„±í•  ê¶Œë¦¬ê°€ ìˆë‹¤.' },
                { id: 'q4', text: 'êµìœ¡ê³¼ì •ì€ êµ­ê°€ì˜ ê¸°ë³¸ì ì¸ êµìœ¡ ëª©í‘œì™€ ê°€ì¹˜ë¥¼ ëª…í™•íˆ ì œì‹œí•´ì•¼ í•œë‹¤.' },
                { id: 'q5', text: 'í•™ìƒë“¤ì€ êµìœ¡ê³¼ì • ê°œë°œê³¼ ìš´ì˜ ê³¼ì •ì— ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•´ì•¼ í•œë‹¤.' },
                { id: 'q6', text: 'êµìœ¡ê³¼ì •ì€ êµì‚¬ì˜ ì „ë¬¸ì„±ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ì—¬ì§€ë¥¼ ì¶©ë¶„íˆ ì œê³µí•´ì•¼ í•œë‹¤.' },
                { id: 'q7', text: 'êµìœ¡ê³¼ì •ì€ í‰ê°€ì˜ ê³µì •ì„±ê³¼ ê°ê´€ì„±ì„ í™•ë³´í•˜ëŠ” ë° ì¤‘ì ì„ ë‘ì–´ì•¼ í•œë‹¤.' },
                { id: 'q8', text: 'êµìœ¡ê³¼ì •ì€ ë‹¤ì–‘í•œ ë¬¸í™”ì  ë°°ê²½ì„ ê°€ì§„ í•™ìƒë“¤ì„ í¬ìš©í•´ì•¼ í•œë‹¤.' },
                { id: 'q9', text: 'ê¸°ìˆ  ë°œì „ì€ êµìœ¡ê³¼ì •ì˜ ë‚´ìš©ì„ ëŠì„ì—†ì´ ë³€í™”ì‹œì¼œì•¼ í•œë‹¤.' },
                { id: 'q10', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì—ê²Œ ë¹„íŒì  ì‚¬ê³  ëŠ¥ë ¥ì„ í•¨ì–‘ì‹œí‚¤ëŠ” ë° ì£¼ë ¥í•´ì•¼ í•œë‹¤.' },
                { id: 'q11', text: 'êµì‚¬ì˜ ì—­í• ì€ êµìœ¡ê³¼ì •ì— ëª…ì‹œëœ ë‚´ìš©ì„ ì •í™•í•˜ê²Œ ì „ë‹¬í•˜ëŠ” ê²ƒì´ë‹¤.' },
                { id: 'q12', text: 'êµìœ¡ê³¼ì •ì€ ì°½ì˜ì„±ê³¼ í˜ì‹ ì„ ìœ„í•œ íƒêµ¬ í™œë™ì„ ê°•ì¡°í•´ì•¼ í•œë‹¤.' },
                { id: 'q13', text: 'êµìœ¡ê³¼ì •ì€ íŠ¹ì • ê³¼ëª© ì§€ì‹ë³´ë‹¤ ì „ì¸ì  ì„±ì¥ì„ ìœ„í•œ ê²½í—˜ì„ ì œê³µí•´ì•¼ í•œë‹¤.' },
                { id: 'q14', text: 'êµìœ¡ê³¼ì •ì€ ì§€ì—­ ì‚¬íšŒì˜ íŠ¹ì„±ê³¼ ìš”êµ¬ë¥¼ ë°˜ì˜í•˜ì—¬ ìœ ì—°í•˜ê²Œ ìš´ì˜ë˜ì–´ì•¼ í•œë‹¤.' },
                { id: 'q15', text: 'êµìœ¡ê³¼ì • ê°œë°œ ì‹œ í•™ìƒë“¤ì˜ ì˜ê²¬ ìˆ˜ë ´ ê³¼ì •ì´ í•„ìˆ˜ì ì´ë‹¤.' },
                { id: 'q16', text: 'êµì‚¬ëŠ” êµìœ¡ê³¼ì • ì¬êµ¬ì„±ì„ ìœ„í•´ ì§€ì†ì ì¸ ì—°ìˆ˜ì™€ ì—°êµ¬ê°€ í•„ìš”í•˜ë‹¤.' },
                { id: 'q17', text: 'êµìœ¡ê³¼ì •ì€ ê²°ê³¼ ì¤‘ì‹¬ í‰ê°€ë³´ë‹¤ ê³¼ì • ì¤‘ì‹¬ í‰ê°€ë¥¼ ìš°ì„ í•´ì•¼ í•œë‹¤.' },
                { id: 'q18', text: 'ë¯¸ë˜ ì‚¬íšŒë¥¼ ëŒ€ë¹„í•˜ì—¬ êµìœ¡ê³¼ì •ì— ë””ì§€í„¸ ë¦¬í„°ëŸ¬ì‹œ êµìœ¡ì„ ê°•í™”í•´ì•¼ í•œë‹¤.' },
                { id: 'q19', text: 'êµìœ¡ê³¼ì •ì€ í•™ìŠµ ë‚´ìš©ì˜ ì–‘ë³´ë‹¤ëŠ” ì§ˆì  ê¹Šì´ë¥¼ ì¶”êµ¬í•´ì•¼ í•œë‹¤.' },
                { id: 'q20', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì˜ ì§„ë¡œ íƒìƒ‰ê³¼ ì„¤ê³„ë¥¼ ì ê·¹ì ìœ¼ë¡œ ì§€ì›í•´ì•¼ í•œë‹¤.' },
                { id: 'q21', text: 'êµìœ¡ê³¼ì •ì€ í•™êµ ê°„, ì§€ì—­ ê°„ í•™ë ¥ ê²©ì°¨ í•´ì†Œì— ê¸°ì—¬í•´ì•¼ í•œë‹¤.' },
                { id: 'q22', text: 'êµì‚¬ëŠ” êµìœ¡ê³¼ì • ì‹¤í–‰ ì‹œ ë°œìƒí•˜ëŠ” ë¬¸ì œ ìƒí™©ì„ ì ê·¹ì ìœ¼ë¡œ í•´ê²°í•´ì•¼ í•œë‹¤.' },
                { id: 'q23', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì—ê²Œ ìê¸° ì£¼ë„ í•™ìŠµ ëŠ¥ë ¥ì„ ê¸¸ëŸ¬ì£¼ëŠ” ë°©í–¥ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•œë‹¤.' },
                { id: 'q24', text: 'êµìœ¡ê³¼ì •ì€ ë‹¤ì–‘í•œ êµê³¼ë¥¼ í†µí•©í•˜ì—¬ ìœ ê¸°ì ìœ¼ë¡œ êµ¬ì„±í•´ì•¼ í•œë‹¤.' },
                { id: 'q25', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì—ê²Œ ì‚¬íšŒì  ì±…ì„ê°ê³¼ ì‹œë¯¼ ì˜ì‹ì„ í•¨ì–‘ì‹œì¼œì•¼ í•œë‹¤.' },
                { id: 'q26', text: 'êµì‚¬ëŠ” êµìœ¡ê³¼ì • ìš´ì˜ì˜ ììœ¨ì„±ì„ ì¡´ì¤‘ë°›ì•„ì•¼ í•œë‹¤.' },
                { id: 'q27', text: 'êµìœ¡ê³¼ì •ì€ ê¸‰ë³€í•˜ëŠ” ì‹œëŒ€ì— ì ì‘í•  ìˆ˜ ìˆëŠ” ìœ ì—°ì„±ì„ ê°–ì¶°ì•¼ í•œë‹¤.' },
                { id: 'q28', text: 'êµìœ¡ê³¼ì •ì€ ì¸ì„± êµìœ¡ì„ ê°•í™”í•˜ê³  ê°€ì¹˜ê´€ í˜•ì„±ì— ë„ì›€ì„ ì£¼ì–´ì•¼ í•œë‹¤.' },
                { id: 'q29', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì˜ ê±´ê°•í•œ ì‹ ì²´ ë°œë‹¬ì„ ìœ„í•œ ë‚´ìš©ì„ í¬í•¨í•´ì•¼ í•œë‹¤.' },
                { id: 'q30', text: 'êµì‚¬ëŠ” êµìœ¡ê³¼ì • í‰ê°€ ê²°ê³¼ì— ë”°ë¼ êµìœ¡ ë°©ë²•ì„ ê°œì„ í•´ì•¼ í•œë‹¤.' },
                { id: 'q31', text: 'êµìœ¡ê³¼ì •ì€ êµ­ê°€ êµìœ¡ ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ êµ¬ì²´ì ì¸ ì§€ì¹¨ì„ ì œê³µí•´ì•¼ í•œë‹¤.' },
                { id: 'q32', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì˜ ì ì¬ë ¥ì„ ìµœëŒ€í•œ ë°œíœ˜í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•´ì•¼ í•œë‹¤.' },
                { id: 'q33', text: 'êµìœ¡ê³¼ì •ì€ êµê³¼ ì§€ì‹ ì „ë‹¬ì„ ë„˜ì–´ ì‹¤ìƒí™œ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì„ ê°•ì¡°í•´ì•¼ í•œë‹¤.' },
                { id: 'q34', text: 'êµì‚¬ëŠ” êµìœ¡ê³¼ì • ê´€ë ¨ ì „ë¬¸ê°€ë“¤ê³¼ ì§€ì†ì ìœ¼ë¡œ í˜‘ë ¥í•´ì•¼ í•œë‹¤.' },
                { id: 'q35', text: 'êµìœ¡ê³¼ì •ì€ í•™ìƒë“¤ì´ ë¹„íŒì  ì‹œê°ìœ¼ë¡œ ì„¸ìƒì„ ì´í•´í•˜ë„ë¡ ë•ëŠ” ì—­í• ì„ í•´ì•¼ í•œë‹¤.' }
            ];

            const poolList = document.getElementById('poolList');
            poolList.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°
            qStatements.forEach(statement => {
                const card = document.createElement('div');
                card.className = 'card';
                card.setAttribute('draggable', 'true');
                card.setAttribute('data-id', statement.id);
                card.textContent = statement.text;
                poolList.appendChild(card);
            });

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupDragAndDrop();
            updateCounts(); // ì¹´ë“œ ê°œìˆ˜ ì´ˆê¸°í™”
        }

        // --- Q-Sorting ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ ë¡œì§ ---
        function setupDragAndDrop() {
            const cards = document.querySelectorAll('.card');
            const buckets = document.querySelectorAll('.bucket');

            cards.forEach(card => {
                card.addEventListener('dragstart', dragStart);
            });

            buckets.forEach(bucket => {
                bucket.addEventListener('dragover', dragOver);
                bucket.addEventListener('dragleave', dragLeave);
                bucket.addEventListener('drop', drop);
            });

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ë³¸ ë™ì‘ ì„¤ì •: poolListë„ ë“œë¡­ì¡´ìœ¼ë¡œ ì„¤ì •
            const poolList = document.getElementById('poolList');
            poolList.addEventListener('dragover', dragOver);
            poolList.addEventListener('dragleave', dragLeave);
            poolList.addEventListener('drop', drop);


            function dragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.dataset.id);
                setTimeout(() => e.target.classList.add('dragging'), 0);
            }

            function dragOver(e) {
                e.preventDefault(); // ë“œë¡­ í—ˆìš©
                if (e.target.classList.contains('bucket') || e.target.id === 'poolList') {
                     e.target.closest('.col')?.classList.add('over');
                     if (e.target.id === 'poolList') {
                         e.target.classList.add('over');
                     }
                }
            }

            function dragLeave(e) {
                if (e.target.closest('.col')) {
                    e.target.closest('.col').classList.remove('over');
                }
                 if (e.target.id === 'poolList') {
                     e.target.classList.remove('over');
                 }
            }

            function drop(e) {
                e.preventDefault();
                const cardId = e.dataTransfer.getData('text/plain');
                const draggedCard = document.querySelector(`.card[data-id="${cardId}"]`);
                const targetBucket = e.target.closest('.bucket');
                const targetCol = e.target.closest('.col');
                
                // ë“œë˜ê·¸ ì¤‘ì¸ ì¹´ë“œ ìƒíƒœ ì´ˆê¸°í™”
                if (draggedCard) {
                    draggedCard.classList.remove('dragging');
                }
                document.querySelectorAll('.col.over, #poolList.over').forEach(el => el.classList.remove('over'));


                if (targetBucket && targetCol) { // íŠ¹ì • ì ìˆ˜ ë²„í‚·ìœ¼ë¡œ ë“œë¡­
                    const score = parseInt(targetCol.dataset.score);
                    const cap = parseInt(targetCol.querySelector('.cap').getAttribute('data-initial-cap'));
                    
                    if (targetBucket.children.length < cap) {
                        targetBucket.appendChild(draggedCard);
                        updateCounts();
                    } else {
                        alert(`ì´ ì¹¸ì€ ${cap}ê°œì˜ ì¹´ë“œë§Œ ìˆ˜ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    }
                } else if (e.target.id === 'poolList' || e.target.closest('#poolList')) { // ì¹´ë“œ í’€ë¡œ ë“œë¡­
                    poolList.appendChild(draggedCard);
                    updateCounts();
                } else {
                     // ìœ íš¨í•˜ì§€ ì•Šì€ ë“œë¡­ ìœ„ì¹˜, ì¹´ë“œë¥¼ ì›ë˜ ìœ„ì¹˜ë¡œ ëŒë¦¬ê±°ë‚˜ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ.
                     // í˜„ì¬ êµ¬í˜„ì€ ë“œë˜ê·¸ ì‹œì‘ ì „ ìœ„ì¹˜ë¥¼ ê¸°ì–µí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì´ ê²½ìš° poolë¡œ ëŒë ¤ë³´ëƒ„.
                     poolList.appendChild(draggedCard);
                     updateCounts();
                }
            }
        }
        
        // ì¹´ë“œ ê°œìˆ˜ ì—…ë°ì´íŠ¸ ë° ì‹œê°í™”
        function updateCounts() {
            const poolList = document.getElementById('poolList');
            const poolCountSpan = document.getElementById('poolCount');
            const totalCards = 35; // ì „ì²´ ì¹´ë“œ ê°œìˆ˜ (Q ì§„ìˆ ë¬¸ ê°œìˆ˜)
            
            // poolListì— ë‚¨ì•„ìˆëŠ” ì¹´ë“œ ìˆ˜ ì—…ë°ì´íŠ¸
            poolCountSpan.textContent = totalCards - Array.from(document.querySelectorAll('.bucket .card')).length;

            if (poolCountSpan.textContent === '0') {
                poolCountSpan.className = 'count-ok';
            } else if (parseInt(poolCountSpan.textContent) < 5) {
                poolCountSpan.className = 'count-warn';
            } else {
                poolCountSpan.className = 'count-bad';
            }

            const cols = document.querySelectorAll('.col');
            let allColsFilled = true;
            cols.forEach(col => {
                const score = parseInt(col.dataset.score);
                const capElement = col.querySelector('.col-header .cap');
                // cap ê°’ì„ data-initial-capì—ì„œ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜ì •
                const cap = parseInt(capElement.getAttribute('data-initial-cap')); 
                const current = col.querySelector('.bucket').children.length;
                
                capElement.textContent = `${current} / ${cap}ê°œ`; // í˜„ì¬ ì¹´ìš´íŠ¸ / ìµœëŒ€ ê°œìˆ˜
                if (current === cap) {
                    capElement.className = 'cap count-ok';
                } else {
                    capElement.className = 'cap count-warn'; // ëœ ì±„ì›Œì¡Œê±°ë‚˜ ë„˜ì¹œ ê²½ìš°
                    allColsFilled = false;
                }
            });

            // ì œì¶œ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” (ëª¨ë“  ì¹´ë“œê°€ ë¶„ë¥˜ë˜ê³  ëª¨ë“  ì¹¸ì´ ì˜¬ë°”ë¥´ê²Œ ì±„ì›Œì¡Œì„ ë•Œ)
            const submitBtn = document.getElementById('submitBtn');
            const isAllQCardSorted = poolCountSpan.textContent === '0' && allColsFilled;
            if (isAllQCardSorted) {
                submitBtn.removeAttribute('disabled');
            } else {
                submitBtn.setAttribute('disabled', 'true');
            }
        }

        // Q ë¶„ë¥˜ ê²°ê³¼ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function collectQSortingResults() {
            const results = {};
            const cols = document.querySelectorAll('.col');
            let isValid = true; // ëª¨ë“  ì¹¸ì´ ì˜¬ë°”ë¥´ê²Œ ì±„ì›Œì¡ŒëŠ”ì§€ í™•ì¸

            cols.forEach(col => {
                const score = parseInt(col.dataset.score);
                const cap = parseInt(col.querySelector('.cap').getAttribute('data-initial-cap'));
                const cardsInBucket = Array.from(col.querySelector('.bucket').children);

                if (cardsInBucket.length !== cap) {
                    isValid = false; // ì¹¸ì˜ ê°œìˆ˜ê°€ ë§ì§€ ì•ŠìŒ
                    return;
                }

                cardsInBucket.forEach(card => {
                    results[card.dataset.id] = score;
                });
            });

            const poolList = document.getElementById('poolList');
            if (poolList.children.length > 0) {
                isValid = false; // ì¹´ë“œ í’€ì— ì¹´ë“œê°€ ë‚¨ì•„ìˆìŒ
            }
            
            if (!isValid) {
                alert('ëª¨ë“  Q ì§„ìˆ ë¬¸ì„ ì •í™•í•œ ê°œìˆ˜ì— ë§ì¶° ë¶„ë¥˜í•´ì•¼ ì„¤ë¬¸ì„ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return null;
            }
            return results;
        }

        // ìµœì´ˆ í˜ì´ì§€ ë¡œë“œ ì‹œ, .cap ìš”ì†Œì— data-initial-cap ì†ì„± ì¶”ê°€ (í•œë²ˆë§Œ ì‹¤í–‰)
        document.querySelectorAll('.col-header .cap').forEach(capElement => {
            if (!capElement.hasAttribute('data-initial-cap')) {
                const initialCapText = capElement.textContent.match(/\d+/); // "2ê°œ"ì—ì„œ "2" ì¶”ì¶œ
                if (initialCapText) {
                    capElement.setAttribute('data-initial-cap', parseInt(initialCapText[0]));
                }
            }
        });

    </script>
</body>
</html>
